<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Linear Models | Kitab at-Tabakh</title>
  <meta name="description" content="This is a collection of miscellaneous statistics-related recipes and notes." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Linear Models | Kitab at-Tabakh" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a collection of miscellaneous statistics-related recipes and notes." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Linear Models | Kitab at-Tabakh" />
  
  <meta name="twitter:description" content="This is a collection of miscellaneous statistics-related recipes and notes." />
  

<meta name="author" content="Peter Geelan-Small" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidyverse.html"/>
<link rel="next" href="linear-mixed-models.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="1" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html"><i class="fa fa-check"></i><b>1</b> Mutanawwiyat</a>
<ul>
<li class="chapter" data-level="1.1" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#confounders"><i class="fa fa-check"></i><b>1.1</b> Confounders</a></li>
<li class="chapter" data-level="1.2" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#exponential-models"><i class="fa fa-check"></i><b>1.2</b> Exponential models</a></li>
<li class="chapter" data-level="1.3" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#power-function"><i class="fa fa-check"></i><b>1.3</b> Power function</a></li>
<li class="chapter" data-level="1.4" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#roc-curves"><i class="fa fa-check"></i><b>1.4</b> ROC curves</a></li>
<li class="chapter" data-level="1.5" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#variable-selection"><i class="fa fa-check"></i><b>1.5</b> Variable selection</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#davison-2003-statistical-models"><i class="fa fa-check"></i><b>1.5.1</b> Davison 2003, Statistical Models</a></li>
<li class="chapter" data-level="1.5.2" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#faraway-2014-linear-models-with-r"><i class="fa fa-check"></i><b>1.5.2</b> Faraway 2014, Linear Models with R</a></li>
<li class="chapter" data-level="1.5.3" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#faraway-2016-extending-the-linear-model-with-r-2nd-ed."><i class="fa fa-check"></i><b>1.5.3</b> Faraway 2016, Extending the Linear Model with R, 2nd ed.</a></li>
<li class="chapter" data-level="1.5.4" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#weisberg-2014-applied-linear-regression-4th-ed."><i class="fa fa-check"></i><b>1.5.4</b> Weisberg 2014, Applied Linear Regression, 4th ed.</a></li>
<li class="chapter" data-level="1.5.5" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#harrell-2015-regression-modeling-strategies-2nd-ed."><i class="fa fa-check"></i><b>1.5.5</b> Harrell 2015, Regression Modeling Strategies, 2nd ed.</a></li>
<li class="chapter" data-level="1.5.6" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#david-wartons-draft-book-chapter-5"><i class="fa fa-check"></i><b>1.5.6</b> David Warton’s draft book, chapter 5</a></li>
<li class="chapter" data-level="1.5.7" data-path="mutanawwiyat.html"><a href="mutanawwiyat.html#james-et-al.-introduction-to-statistical-learning-2017-corrected-printing"><i class="fa fa-check"></i><b>1.5.7</b> James et al. Introduction to Statistical Learning, 2017 (corrected printing)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>2</b> ggplot</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ggplot.html"><a href="ggplot.html#vignettes"><i class="fa fa-check"></i><b>2.1</b> Vignettes</a></li>
<li class="chapter" data-level="2.2" data-path="ggplot.html"><a href="ggplot.html#confidence-bands"><i class="fa fa-check"></i><b>2.2</b> Confidence bands</a></li>
<li class="chapter" data-level="2.3" data-path="ggplot.html"><a href="ggplot.html#confidence-bands-fitted-models"><i class="fa fa-check"></i><b>2.3</b> Confidence bands: fitted models</a></li>
<li class="chapter" data-level="2.4" data-path="ggplot.html"><a href="ggplot.html#histogram"><i class="fa fa-check"></i><b>2.4</b> Histogram</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="ggplot.html"><a href="ggplot.html#histogram-one-vector-of-values"><i class="fa fa-check"></i><b>2.4.1</b> Histogram: one vector of values</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="ggplot.html"><a href="ggplot.html#density-plot"><i class="fa fa-check"></i><b>2.5</b> Density plot</a></li>
<li class="chapter" data-level="2.6" data-path="ggplot.html"><a href="ggplot.html#plot-structure"><i class="fa fa-check"></i><b>2.6</b> Plot structure</a></li>
<li class="chapter" data-level="2.7" data-path="ggplot.html"><a href="ggplot.html#label-legend"><i class="fa fa-check"></i><b>2.7</b> Label legend</a></li>
<li class="chapter" data-level="2.8" data-path="ggplot.html"><a href="ggplot.html#plot-title"><i class="fa fa-check"></i><b>2.8</b> Plot title</a></li>
<li class="chapter" data-level="2.9" data-path="ggplot.html"><a href="ggplot.html#three-category-colours"><i class="fa fa-check"></i><b>2.9</b> Three-category colours</a></li>
<li class="chapter" data-level="2.10" data-path="ggplot.html"><a href="ggplot.html#set-breaks-for-scale"><i class="fa fa-check"></i><b>2.10</b> Set breaks for scale</a></li>
<li class="chapter" data-level="2.11" data-path="ggplot.html"><a href="ggplot.html#display-table-to-2-d.p."><i class="fa fa-check"></i><b>2.11</b> Display table to 2 d.p.</a></li>
<li class="chapter" data-level="2.12" data-path="ggplot.html"><a href="ggplot.html#redefine-factor-levels-for-an-individual-plot"><i class="fa fa-check"></i><b>2.12</b> Redefine factor levels for an individual plot</a></li>
<li class="chapter" data-level="2.13" data-path="ggplot.html"><a href="ggplot.html#plotting-two-data-sets-of-different-length-on-one-plot"><i class="fa fa-check"></i><b>2.13</b> Plotting two data sets of different length on one plot</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>3</b> R Markdown</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-markdown.html"><a href="r-markdown.html#ioslides-footnotes"><i class="fa fa-check"></i><b>3.1</b> ioslides: Footnotes</a></li>
<li class="chapter" data-level="3.2" data-path="r-markdown.html"><a href="r-markdown.html#ioslides-speakers-notes"><i class="fa fa-check"></i><b>3.2</b> ioslides: Speaker’s notes</a></li>
<li class="chapter" data-level="3.3" data-path="r-markdown.html"><a href="r-markdown.html#how-to-make-multi-line-tables"><i class="fa fa-check"></i><b>3.3</b> How to make multi-line tables</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>4</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidyverse.html"><a href="tidyverse.html#stacking-and-unstacking-data"><i class="fa fa-check"></i><b>4.1</b> Stacking and unstacking data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>5</b> Linear Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-models.html"><a href="linear-models.html#anova-orthogonal-factors"><i class="fa fa-check"></i><b>5.1</b> ANOVA: Orthogonal factors</a></li>
<li class="chapter" data-level="5.2" data-path="linear-models.html"><a href="linear-models.html#multiple-linear-regression---conditional-and-marginal-effects"><i class="fa fa-check"></i><b>5.2</b> Multiple linear regression - conditional and marginal effects</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-models.html"><a href="linear-models.html#marginal-and-conditional-interpretations"><i class="fa fa-check"></i><b>5.2.1</b> Marginal and Conditional interpretations</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="linear-models.html"><a href="linear-models.html#linear-model-with-subsampling"><i class="fa fa-check"></i><b>5.3</b> Linear model with subsampling</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="linear-models.html"><a href="linear-models.html#load-necessary-r-packages"><i class="fa fa-check"></i><b>5.3.1</b> Load necessary R packages</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#example"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="5.3.2" data-path="linear-models.html"><a href="linear-models.html#data"><i class="fa fa-check"></i><b>5.3.2</b> Data</a></li>
<li class="chapter" data-level="5.3.3" data-path="linear-models.html"><a href="linear-models.html#summary-statistics-and-plots"><i class="fa fa-check"></i><b>5.3.3</b> Summary statistics and plots</a></li>
<li class="chapter" data-level="5.3.4" data-path="linear-models.html"><a href="linear-models.html#wrong-analysis-fixed-effects-linear-model"><i class="fa fa-check"></i><b>5.3.4</b> Wrong analysis: fixed effects linear model</a></li>
<li class="chapter" data-level="5.3.5" data-path="linear-models.html"><a href="linear-models.html#right-analysis-mixed-effects-linear-model"><i class="fa fa-check"></i><b>5.3.5</b> Right analysis: mixed effects linear model</a></li>
<li class="chapter" data-level="5.3.6" data-path="linear-models.html"><a href="linear-models.html#an-aside---checking-model-assumptions"><i class="fa fa-check"></i><b>5.3.6</b> An aside - checking model assumptions</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#equal-variance-assumption"><i class="fa fa-check"></i>Equal variance assumption</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#normal-distribution-assumption"><i class="fa fa-check"></i>Normal distribution assumption</a></li>
<li class="chapter" data-level="5.3.7" data-path="linear-models.html"><a href="linear-models.html#fitted-values-and-confidence-intervals"><i class="fa fa-check"></i><b>5.3.7</b> Fitted values and confidence intervals</a></li>
<li class="chapter" data-level="5.3.8" data-path="linear-models.html"><a href="linear-models.html#another-aside---code-the-nested-structure---not-recommended"><i class="fa fa-check"></i><b>5.3.8</b> Another aside - code the nested structure - not recommended</a></li>
<li class="chapter" data-level="5.3.9" data-path="linear-models.html"><a href="linear-models.html#summary"><i class="fa fa-check"></i><b>5.3.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="linear-models.html"><a href="linear-models.html#marginal-means---emmeans-example"><i class="fa fa-check"></i><b>5.4</b> Marginal means - emmeans example</a></li>
<li class="chapter" data-level="5.5" data-path="linear-models.html"><a href="linear-models.html#multiple-regression-example"><i class="fa fa-check"></i><b>5.5</b> Multiple regression example</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="linear-models.html"><a href="linear-models.html#regression-model"><i class="fa fa-check"></i><b>5.5.1</b> Regression model</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="linear-models.html"><a href="linear-models.html#residual-plots---redres"><i class="fa fa-check"></i><b>5.6</b> Residual plots - redres</a></li>
<li class="chapter" data-level="5.7" data-path="linear-models.html"><a href="linear-models.html#interactions---examples"><i class="fa fa-check"></i><b>5.7</b> Interactions - examples</a></li>
<li class="chapter" data-level="5.8" data-path="linear-models.html"><a href="linear-models.html#interaction-plot-in-ggplot2"><i class="fa fa-check"></i><b>5.8</b> Interaction plot in ggplot2</a></li>
<li class="chapter" data-level="5.9" data-path="linear-models.html"><a href="linear-models.html#plot-simple-linear-regression-fitted-line-with-95-confidence-band"><i class="fa fa-check"></i><b>5.9</b> Plot simple linear regression fitted line with 95 % confidence band</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html"><i class="fa fa-check"></i><b>6</b> Linear mixed models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#finding-variance-components-from-lme-models"><i class="fa fa-check"></i><b>6.1</b> Finding variance components from lme models</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="experimental-design.html"><a href="experimental-design.html"><i class="fa fa-check"></i><b>7</b> Experimental design</a>
<ul>
<li class="chapter" data-level="7.1" data-path="experimental-design.html"><a href="experimental-design.html#sample-size-by-simulation"><i class="fa fa-check"></i><b>7.1</b> Sample size by simulation</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="count-data.html"><a href="count-data.html"><i class="fa fa-check"></i><b>8</b> Count data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="count-data.html"><a href="count-data.html#count-data-tests-of-independence-and-homogeneity"><i class="fa fa-check"></i><b>8.1</b> Count data: tests of independence and homogeneity</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="count-data.html"><a href="count-data.html#independence"><i class="fa fa-check"></i><b>8.1.1</b> Independence</a></li>
<li class="chapter" data-level="8.1.2" data-path="count-data.html"><a href="count-data.html#homogeneity"><i class="fa fa-check"></i><b>8.1.2</b> Homogeneity</a></li>
<li class="chapter" data-level="8.1.3" data-path="count-data.html"><a href="count-data.html#comparing-two-proportions---equivalence-of-z-and-chi2-tests"><i class="fa fa-check"></i><b>8.1.3</b> Comparing two proportions - equivalence of <span class="math inline">\(z\)</span> and <span class="math inline">\(\chi^2\)</span> tests</a></li>
<li class="chapter" data-level="8.1.4" data-path="count-data.html"><a href="count-data.html#small-counts"><i class="fa fa-check"></i><b>8.1.4</b> Small Counts</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="count-data.html"><a href="count-data.html#contingency-tables---fixed-row-and-columns-totals"><i class="fa fa-check"></i><b>8.2</b> Contingency tables - fixed row and columns totals</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html"><i class="fa fa-check"></i><b>9</b> Means - fitted and marginal</a>
<ul>
<li class="chapter" data-level="9.1" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#load-necessary-packages"><i class="fa fa-check"></i><b>9.1</b> Load necessary packages</a></li>
<li class="chapter" data-level="9.2" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#data---genotype-from-mass-package"><i class="fa fa-check"></i><b>9.2</b> Data - “genotype” from MASS package</a></li>
<li class="chapter" data-level="9.3" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#model"><i class="fa fa-check"></i><b>9.3</b> Model</a></li>
<li class="chapter" data-level="9.4" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#fitted-values-using-predict"><i class="fa fa-check"></i><b>9.4</b> Fitted values using “predict”</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#fitted-values-with-interval-confidence"><i class="fa fa-check"></i><b>9.4.1</b> Fitted values (with interval = “confidence”)</a></li>
<li class="chapter" data-level="9.4.2" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#fitted-values-with-interval-prediction"><i class="fa fa-check"></i><b>9.4.2</b> Fitted values (with interval = “prediction”)</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#manually-fitting-model-using-matrix-algebra"><i class="fa fa-check"></i><b>9.5</b> Manually fitting model using matrix algebra</a></li>
<li class="chapter" data-level="9.6" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#estimated-means-using-model-coefficients-and-various-weights"><i class="fa fa-check"></i><b>9.6</b> Estimated means using model coefficients and various weights</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#marginal-means-for-litter"><i class="fa fa-check"></i><b>9.6.1</b> Marginal means for Litter</a></li>
<li class="chapter" data-level="9.6.2" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#marginal-means-for-mother"><i class="fa fa-check"></i><b>9.6.2</b> Marginal means for Mother</a></li>
<li class="chapter" data-level="9.6.3" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#using-a-matrix-with-equal-weights"><i class="fa fa-check"></i><b>9.6.3</b> Using a matrix with equal weights</a></li>
<li class="chapter" data-level="9.6.4" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#using-a-matrix-with-proportional-weights"><i class="fa fa-check"></i><b>9.6.4</b> Using a matrix with proportional weights</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#estimates-using-effects-package"><i class="fa fa-check"></i><b>9.7</b> Estimates using “effects” package</a></li>
<li class="chapter" data-level="9.8" data-path="means---fitted-and-marginal.html"><a href="means---fitted-and-marginal.html#transformations-and-emmeans"><i class="fa fa-check"></i><b>9.8</b> Transformations and <code>emmeans</code></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Kitab at-Tabakh</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-models" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Linear Models</h1>
<div id="anova-orthogonal-factors" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> ANOVA: Orthogonal factors</h2>
<p><em>Example from Meier, ANOVA (web document)</em></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="linear-models.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create data (skip if not interested) ####</span></span>
<span id="cb102-2"><a href="linear-models.html#cb102-2" aria-hidden="true" tabindex="-1"></a>acids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.697</span>, <span class="fl">1.601</span>, <span class="fl">1.830</span>,</span>
<span id="cb102-3"><a href="linear-models.html#cb102-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">2.032</span>, <span class="fl">2.017</span>, <span class="fl">2.409</span>,</span>
<span id="cb102-4"><a href="linear-models.html#cb102-4" aria-hidden="true" tabindex="-1"></a>           <span class="fl">2.211</span>, <span class="fl">1.673</span>, <span class="fl">1.973</span>, </span>
<span id="cb102-5"><a href="linear-models.html#cb102-5" aria-hidden="true" tabindex="-1"></a>           <span class="fl">2.091</span>, <span class="fl">2.255</span>, <span class="fl">2.987</span>)</span>
<span id="cb102-6"><a href="linear-models.html#cb102-6" aria-hidden="true" tabindex="-1"></a>R50 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb102-7"><a href="linear-models.html#cb102-7" aria-hidden="true" tabindex="-1"></a>R21 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;yes&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb102-8"><a href="linear-models.html#cb102-8" aria-hidden="true" tabindex="-1"></a>cheddar <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(R50, R21, acids)</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="linear-models.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(cheddar)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    12 obs. of  3 variables:
##  $ R50  : chr  &quot;no&quot; &quot;no&quot; &quot;no&quot; &quot;yes&quot; ...
##  $ R21  : chr  &quot;no&quot; &quot;no&quot; &quot;no&quot; &quot;no&quot; ...
##  $ acids: num  1.7 1.6 1.83 2.03 2.02 ...</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="linear-models.html#cb105-1" aria-hidden="true" tabindex="-1"></a>cheddar</span></code></pre></div>
<pre><code>##    R50 R21 acids
## 1   no  no 1.697
## 2   no  no 1.601
## 3   no  no 1.830
## 4  yes  no 2.032
## 5  yes  no 2.017
## 6  yes  no 2.409
## 7   no yes 2.211
## 8   no yes 1.673
## 9   no yes 1.973
## 10 yes yes 2.091
## 11 yes yes 2.255
## 12 yes yes 2.987</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="linear-models.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cheddar<span class="sc">$</span>R21, cheddar<span class="sc">$</span>R50)</span></code></pre></div>
<pre><code>##      
##       no yes
##   no   3   3
##   yes  3   3</code></pre>
<p>Get model matrix for two-factor model</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="linear-models.html#cb109-1" aria-hidden="true" tabindex="-1"></a>cheddar.lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(acids <span class="sc">~</span> R21 <span class="sc">+</span> R50)</span>
<span id="cb109-2"><a href="linear-models.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(cheddar.lm1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: acids
##           Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
## R21        1 0.21440 0.21440  2.6526 0.13782  
## R50        1 0.65614 0.65614  8.1178 0.01911 *
## Residuals  9 0.72744 0.08083                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="linear-models.html#cb111-1" aria-hidden="true" tabindex="-1"></a>cheddar.lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(acids <span class="sc">~</span> R50 <span class="sc">+</span> R21)</span>
<span id="cb111-2"><a href="linear-models.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(cheddar.lm2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: acids
##           Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
## R50        1 0.65614 0.65614  8.1178 0.01911 *
## R21        1 0.21440 0.21440  2.6526 0.13782  
## Residuals  9 0.72744 0.08083                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Sums of squares are the same regardless of the order of R21 and R50 in the model.</p>
<p>Get model matrix.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="linear-models.html#cb113-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(cheddar.lm1)</span>
<span id="cb113-2"><a href="linear-models.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="linear-models.html#cb113-3" aria-hidden="true" tabindex="-1"></a>X</span></code></pre></div>
<pre><code>##    (Intercept) R21yes R50yes
## 1            1      0      0
## 2            1      0      0
## 3            1      0      0
## 4            1      0      1
## 5            1      0      1
## 6            1      0      1
## 7            1      1      0
## 8            1      1      0
## 9            1      1      0
## 10           1      1      1
## 11           1      1      1
## 12           1      1      1
## attr(,&quot;assign&quot;)
## [1] 0 1 2
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$R21
## [1] &quot;contr.treatment&quot;
## 
## attr(,&quot;contrasts&quot;)$R50
## [1] &quot;contr.treatment&quot;</code></pre>
<p>Calculate <span class="math inline">\(\textbf{X}&#39;\textbf{X}\)</span></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="linear-models.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(X) <span class="sc">%*%</span> X</span></code></pre></div>
<pre><code>##             (Intercept) R21yes R50yes
## (Intercept)          12      6      6
## R21yes                6      6      3
## R50yes                6      3      6</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="linear-models.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span></code></pre></div>
<pre><code>##             (Intercept)     R21yes     R50yes
## (Intercept)   0.2500000 -0.1666667 -0.1666667
## R21yes       -0.1666667  0.3333333  0.0000000
## R50yes       -0.1666667  0.0000000  0.3333333</code></pre>
<p><br></p>
</div>
<div id="multiple-linear-regression---conditional-and-marginal-effects" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Multiple linear regression - conditional and marginal effects</h2>
<p><em>Note: See David’s book, ch. 3.</em></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="linear-models.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb119-2"><a href="linear-models.html#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="linear-models.html#cb119-3" aria-hidden="true" tabindex="-1"></a>data_height <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/plantHeightSingleSpp.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 178 Columns: 35</code></pre>
<pre><code>## ── Column specification ──────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (6): Genus_species, Family, growthform, Country, Site, entere...
## dbl (29): sort_number, site, height, loght, lat, long, alt, temp, ...</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="linear-models.html#cb123-1" aria-hidden="true" tabindex="-1"></a>mod_height1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> lat, <span class="at">data =</span> data_height)</span>
<span id="cb123-2"><a href="linear-models.html#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="linear-models.html#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_height1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = height ~ lat, data = data_height)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -13.558  -6.955  -3.978   3.654  54.333 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 14.42516    1.72433   8.366 1.78e-14 ***
## lat         -0.17631    0.04847  -3.637 0.000362 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.95 on 176 degrees of freedom
## Multiple R-squared:  0.06991,    Adjusted R-squared:  0.06463 
## F-statistic: 13.23 on 1 and 176 DF,  p-value: 0.0003617</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="linear-models.html#cb125-1" aria-hidden="true" tabindex="-1"></a>mod_height2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> rain <span class="sc">+</span> lat, <span class="at">data =</span> data_height)</span>
<span id="cb125-2"><a href="linear-models.html#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="linear-models.html#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_height2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = height ~ rain + lat, data = data_height)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -14.738  -5.932  -3.418   2.833  52.188 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.521724   3.077683   1.469 0.143575    
## rain         0.004058   0.001062   3.823 0.000183 ***
## lat         -0.034109   0.059707  -0.571 0.568547    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.55 on 175 degrees of freedom
## Multiple R-squared:  0.1416, Adjusted R-squared:  0.1318 
## F-statistic: 14.43 on 2 and 175 DF,  p-value: 1.579e-06</code></pre>
<p><br></p>
<p>Reverse order of model terms</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="linear-models.html#cb127-1" aria-hidden="true" tabindex="-1"></a>mod_height2a <span class="ot">&lt;-</span> <span class="fu">lm</span>(height <span class="sc">~</span> lat <span class="sc">+</span> rain, <span class="at">data =</span> data_height)</span>
<span id="cb127-2"><a href="linear-models.html#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="linear-models.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_height2a)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = height ~ lat + rain, data = data_height)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -14.738  -5.932  -3.418   2.833  52.188 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.521724   3.077683   1.469 0.143575    
## lat         -0.034109   0.059707  -0.571 0.568547    
## rain         0.004058   0.001062   3.823 0.000183 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.55 on 175 degrees of freedom
## Multiple R-squared:  0.1416, Adjusted R-squared:  0.1318 
## F-statistic: 14.43 on 2 and 175 DF,  p-value: 1.579e-06</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="linear-models.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(mod_height2, <span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## height ~ rain + lat
##        Df Sum of Sq   RSS    AIC F value    Pr(&gt;F)    
## &lt;none&gt;              19469 841.67                      
## rain    1   1625.55 21094 853.95 14.6117 0.0001834 ***
## lat     1     36.31 19505 840.00  0.3264 0.5685469    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br></p>
<div id="marginal-and-conditional-interpretations" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Marginal and Conditional interpretations</h3>
<p>The <strong>marginal effect</strong> of a predictor variable in a regression model is the effect of that variable alone on the outcome, estimated without including any other predictor variable in the model.</p>
<p>The model above with <code>lat</code> as the only predictor variable, mod_height1, gives the <strong>marginal effect</strong> of <code>lat</code> as -0.176.</p>
<p>The <strong>conditional effect</strong> of a predictor variable in a regression model is the effect of that variable on the outcome when other predictors are included in the model and all those other predictors are held constant.</p>
<p>The model above with both <code>lat</code> and <code>rain</code> as predictor variables, mod_height2, gives the <strong>conditional effect</strong> of <code>lat</code>, after controlling for the effect of <code>rain</code>, as -0.034.</p>
<p>Note that in R, the “summary” output for “lm” gives the conditional effect of each predictor variable - i.e. the effect conditional on all the other predictor variables, or in other words, after adjusting for or controlling for, all the other predictor variables. This is shown by comparing the three blocks of output immediately above given by summary(mod_height2), summary(mod_height2a) and drop1(mod_height2).</p>
<p><br></p>
</div>
</div>
<div id="linear-model-with-subsampling" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Linear model with subsampling</h2>
<div id="load-necessary-r-packages" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Load necessary R packages</h3>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="linear-models.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamair)  <span class="do">##  Data</span></span>
<span id="cb131-2"><a href="linear-models.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb131-3"><a href="linear-models.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb131-4"><a href="linear-models.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb131-5"><a href="linear-models.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
</div>
<div id="example" class="section level3 unnumbered">
<h3>Example</h3>
<p><em>Note:</em> This example is from the book, Wood, S. 2017. <em>Generalized Additive Models: An Introduction with R.</em> CRC Press, 2nd ed., pp. 61-65. This book is available as an e-book in UNSW library. (The example is also in the 1st edition of this book on pp. 277-281. Another example of this idea with a different data set, but without the mixed model analysis, is in Steel, R., Torrie, J. and Dickey, D. 1997. <em>Principles and Procedures of Statistics: A Biometrical Approach.</em> McGraw Hill, 3rd ed., pp. 157-165.)</p>
<p>Tree seedlings are grown under two levels of carbon dioxide concentration, with three trees assigned to each treatment. At six months of growth, stomatal area is measured at each of four random locations on each plant.</p>
<p><em>Notes</em></p>
<ul>
<li>“Stomates” are the tiny holes in plant leaves through which carbon dioxide and water vapour are exchanged with the atmosphere during photosynthesis and respiration.</li>
<li>The sample sizes here are artificially small simply to illustrate the ideas.</li>
</ul>
</div>
<div id="data" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Data</h3>
<p>The data, “stomata”, is included in the R package, “gamair”.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="linear-models.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(stomata)</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="linear-models.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(stomata)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    24 obs. of  3 variables:
##  $ area: num  1.61 1.63 1.54 1.72 1.39 ...
##  $ CO2 : Factor w/ 2 levels &quot;1&quot;,&quot;2&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ tree: Factor w/ 6 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 1 1 1 2 2 2 2 3 3 ...</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="linear-models.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stomata)</span></code></pre></div>
<pre><code>##       area CO2 tree
## 1 1.605574   1    1
## 2 1.630071   1    1
## 3 1.539119   1    1
## 4 1.718732   1    1
## 5 1.389616   1    2
## 6 1.585880   1    2</code></pre>
<p>Convert CO2 and tree to factors.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="linear-models.html#cb137-1" aria-hidden="true" tabindex="-1"></a>stomata<span class="sc">$</span>CO2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(stomata<span class="sc">$</span>CO2)</span>
<span id="cb137-2"><a href="linear-models.html#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="linear-models.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  For CO2, &quot;1&quot; is &quot;low&quot; and &quot;2&quot; is &quot;high&quot;.</span></span>
<span id="cb137-4"><a href="linear-models.html#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  Add these labels.</span></span>
<span id="cb137-5"><a href="linear-models.html#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="linear-models.html#cb137-6" aria-hidden="true" tabindex="-1"></a>stomata<span class="sc">$</span>CO2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(stomata<span class="sc">$</span>CO2, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>))</span>
<span id="cb137-7"><a href="linear-models.html#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="linear-models.html#cb137-8" aria-hidden="true" tabindex="-1"></a>stomata<span class="sc">$</span>tree <span class="ot">&lt;-</span> <span class="fu">factor</span>(stomata<span class="sc">$</span>tree)</span></code></pre></div>
</div>
<div id="summary-statistics-and-plots" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Summary statistics and plots</h3>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="linear-models.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stomata)</span></code></pre></div>
<pre><code>##       area          CO2     tree 
##  Min.   :0.8753   low :12   1:4  
##  1st Qu.:1.5396   high:12   2:4  
##  Median :2.0166             3:4  
##  Mean   :2.0679             4:4  
##  3rd Qu.:2.7600             5:4  
##  Max.   :3.1149             6:4</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="linear-models.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(stomata<span class="sc">$</span>area <span class="sc">~</span> stomata<span class="sc">$</span>CO2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>Plot with a strip plot (strip chart) as sample sizes are small.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="linear-models.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stripchart</span>(area <span class="sc">~</span> CO2, <span class="at">data =</span> stomata, <span class="at">ylab =</span> <span class="st">&quot;CO2 conc.&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="linear-models.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stomata, <span class="fu">aes</span>(<span class="at">x =</span> CO2, <span class="at">y =</span> area, <span class="at">colour =</span> tree)) <span class="sc">+</span></span>
<span id="cb142-2"><a href="linear-models.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="fl">0.075</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<p>The variance appears fairly constant and the distribution looks fairly symmetric. (This suggests the linear model assumptions will be met, but they’ll be checked later. The purpose of this example is to illustrate the proper way to analyse data from this type of experimental design and not to worry about assumptions, though.)</p>
<p>Note: Where you’ve got data with a quantitative, continuous response variable, the usual function to use for a linear model is “lm”. In the short course, <em>Introductory Statistics for Researchers</em>, we used a function, “aov”, for the one-way ANOVA model we fitted. That function is fairly limited in when you can use it and so “lm” is the function most commonly used. However, there are situations where lm is not appropriate.</p>
<p><br></p>
<p><strong>The following analyses are taken from the book by Simon Wood cited above. Explanations of what’s going on are more detailed in the book. It’s useful to read the material in the book about this example but not to worry about the technical details there.</strong></p>
<p><br></p>
</div>
<div id="wrong-analysis-fixed-effects-linear-model" class="section level3" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> Wrong analysis: fixed effects linear model</h3>
<p>To account for stomatal area here, we’d expect some contribution from CO2 concentration (there are two levels, low and high) and some contribution from individual trees. The following analysis looks reasonable at face value.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="linear-models.html#cb143-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(area <span class="sc">~</span> CO2 <span class="sc">+</span> tree, <span class="at">data =</span> stomata)</span>
<span id="cb143-2"><a href="linear-models.html#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="linear-models.html#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = area ~ CO2 + tree, data = stomata)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.30672 -0.10625 -0.01528  0.08436  0.37674 
## 
## Coefficients: (1 not defined because of singularities)
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.62337    0.10932  14.850 1.52e-11 ***
## CO2high      0.70639    0.15460   4.569 0.000238 ***
## tree2       -0.02473    0.15460  -0.160 0.874685    
## tree3       -0.46041    0.15460  -2.978 0.008059 ** 
## tree4        0.45948    0.15460   2.972 0.008166 ** 
## tree5        0.57378    0.15460   3.711 0.001597 ** 
## tree6             NA         NA      NA       NA    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2186 on 18 degrees of freedom
## Multiple R-squared:  0.9215, Adjusted R-squared:  0.8997 
## F-statistic: 42.24 on 5 and 18 DF,  p-value: 2.511e-09</code></pre>
<p>From above, <span class="math inline">\(P &lt; 0.0001\)</span>. The “NAs” in the output look odd.</p>
<p>The above model is wrong, however, because CO2 and tree are confounded. Trees are nested in CO2 treatments - we cannot, for example, separate the effect of low CO2 from the effect of tree 1 on the predicted value of area for that tree.</p>
<p>Compare the above model with a model including only CO2. The “anova” function below compares the two models - the <span class="math inline">\(P\)</span> value in the output is testing whether the two models are no better than each other.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="linear-models.html#cb145-1" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(area <span class="sc">~</span> CO2, <span class="at">data =</span> stomata)</span>
<span id="cb145-2"><a href="linear-models.html#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="linear-models.html#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m0, m1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: area ~ CO2
## Model 2: area ~ CO2 + tree
##   Res.Df    RSS Df Sum of Sq      F   Pr(&gt;F)   
## 1     22 2.1348                                
## 2     18 0.8604  4    1.2744 6.6654 0.001788 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The above output says that the models are not equally good ( <span class="math inline">\(P = 0.002\)</span>, the <span class="math inline">\(P\)</span> value is very small); consequently, the larger model is better - with more explanatory variables, it has more explanatory value. As model m0 contains only CO2 and m1 contains both CO2 and tree, then tree differences are important. However, from those models, we have no way of testing whether CO2 differences are important (as the only difference between the models was whether they included tree or not).</p>
<p>Test for CO2 effects by comparing models with tree but with and without CO2.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="linear-models.html#cb147-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(area <span class="sc">~</span> tree, <span class="at">data =</span> stomata)</span>
<span id="cb147-2"><a href="linear-models.html#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="linear-models.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m2, m1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: area ~ tree
## Model 2: area ~ CO2 + tree
##   Res.Df    RSS Df  Sum of Sq F Pr(&gt;F)
## 1     18 0.8604                       
## 2     18 0.8604  0 2.2204e-16</code></pre>
<p>The above output shows the two models are the same (the RSS, residual sum of squares, for each is the same) and so we cannot use this analysis to test for CO2 effects. This is caused by the confounding problem.</p>
<p>One way of getting around this problem is to average the response variable values for each tree and use the averaged values as our response variable.</p>
<p><strong>Note you can only do this if there are the same number of data values in each group you average and there are no missing values!</strong></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="linear-models.html#cb149-1" aria-hidden="true" tabindex="-1"></a>stomata.avg <span class="ot">&lt;-</span> stomata <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(tree) <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="linear-models.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">area =</span> <span class="fu">mean</span>(area)) </span>
<span id="cb149-3"><a href="linear-models.html#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="linear-models.html#cb149-4" aria-hidden="true" tabindex="-1"></a>CO2_by_tree <span class="ot">&lt;-</span> stomata <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(tree, CO2)</span>
<span id="cb149-5"><a href="linear-models.html#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="linear-models.html#cb149-6" aria-hidden="true" tabindex="-1"></a>stomata.avg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(stomata.avg, <span class="at">CO2 =</span> CO2_by_tree<span class="sc">$</span>CO2)</span>
<span id="cb149-7"><a href="linear-models.html#cb149-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-8"><a href="linear-models.html#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(stomata.avg)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    6 obs. of  3 variables:
##  $ tree: Factor w/ 6 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6
##  $ area: num  1.62 1.6 1.16 2.79 2.9 ...
##  $ CO2 : Factor w/ 2 levels &quot;low&quot;,&quot;high&quot;: 1 1 1 2 2 2</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="linear-models.html#cb151-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(area <span class="sc">~</span> CO2, <span class="at">data =</span> stomata.avg)</span>
<span id="cb151-2"><a href="linear-models.html#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="linear-models.html#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = area ~ CO2, data = stomata.avg)
## 
## Residuals:
##       1       2       3       4       5       6 
##  0.1617  0.1370 -0.2987  0.1151  0.2294 -0.3444 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.4617     0.1629   8.970 0.000855 ***
## CO2high       1.2125     0.2304   5.262 0.006247 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2822 on 4 degrees of freedom
## Multiple R-squared:  0.8738, Adjusted R-squared:  0.8422 
## F-statistic: 27.69 on 1 and 4 DF,  p-value: 0.006247</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="linear-models.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m3)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: area
##           Df  Sum Sq Mean Sq F value   Pr(&gt;F)   
## CO2        1 2.20531 2.20531  27.687 0.006247 **
## Residuals  4 0.31861 0.07965                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The above analysis is valid, although it does involve a two-step process where you average the data for each tree first.</p>
<p>Another way of getting around this problem is to use the “aov” function here. <em>Note the same conditions in bold above apply to using the aov function.</em> We use the original, non-averaged data with aov.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="linear-models.html#cb155-1" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">aov</span>(area <span class="sc">~</span> CO2 <span class="sc">+</span> <span class="fu">Error</span>(tree), <span class="at">data =</span> stomata)</span>
<span id="cb155-2"><a href="linear-models.html#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="linear-models.html#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m4)</span></code></pre></div>
<pre><code>## 
## Error: tree
##           Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## CO2        1  8.821   8.821   27.69 0.00625 **
## Residuals  4  1.274   0.319                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Error: Within
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## Residuals 18 0.8604  0.0478</code></pre>
<p>From the above two analyses, the correct <span class="math inline">\(P\)</span> value for the effect of CO2 is 0.00625.</p>
<p><br></p>
</div>
<div id="right-analysis-mixed-effects-linear-model" class="section level3" number="5.3.5">
<h3><span class="header-section-number">5.3.5</span> Right analysis: mixed effects linear model</h3>
<p>A better (and correct) approach is to use a mixed effects model. <em>This works even if treatment groups do not have the same number of replicates (or if there are missing values).</em></p>
<p>In this approach, tree is included as a grouping variable to identify clusters of data values (i.e. to identify which observed values come from which tree). Observations from the same tree will be correlated to some extent and this needs to be incorporated in the model via a grouping variable. If these groups were not specified in the model, it would appear as if all observations were independent and this would lead to smaller uncertainty in the estimates of treatment effects (because you’d be overstaing the number of independent observations, and hence, the amount of information you really had, or “information value” of your data). The trees in the study are considered as being randomly sampled from the (large) population of trees we are studying. The effects of individual trees are not considered important but they need to be included in the model to identify groups of data values.</p>
<p>So, let’s fit a mixed model. You can use the “nlme” package or the “lme4” package. The nlme package is used here because it gives <span class="math inline">\(P\)</span> values, while the lme4 package does not (another story!).</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="linear-models.html#cb157-1" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">lme</span>(area <span class="sc">~</span> CO2, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> tree, <span class="at">data =</span> stomata)</span>
<span id="cb157-2"><a href="linear-models.html#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="linear-models.html#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(m5)</span></span>
<span id="cb157-4"><a href="linear-models.html#cb157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-5"><a href="linear-models.html#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m5)<span class="sc">$</span>tTable</span></code></pre></div>
<pre><code>##                Value Std.Error DF  t-value      p-value
## (Intercept) 1.461659 0.1629435 18 8.970341 4.625996e-08
## CO2high     1.212522 0.2304370  4 5.261837 6.246688e-03</code></pre>
<p>From the above output, the <span class="math inline">\(P\)</span> value for the effect of CO2 concentration is 0.00625. This is the same as the <span class="math inline">\(P\)</span> values above using the averaged data and using the aov function.</p>
<p><br></p>
</div>
<div id="an-aside---checking-model-assumptions" class="section level3" number="5.3.6">
<h3><span class="header-section-number">5.3.6</span> An aside - checking model assumptions</h3>
<p>Let’s check the assumptions for the mixed model because we can. This shows how to check the two assumptions of constant variance and Normal distribution for a linear mixed model. We won’t worry here about whether the assumptions are satisfied, as the emphasis is on appropriate methods to use.</p>
</div>
<div id="equal-variance-assumption" class="section level3 unnumbered">
<h3>Equal variance assumption</h3>
<p>Use the plot function with the model name. This produces a residuals vs fitted values plot, which is the standard plot for checking the constant variance assumption.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="linear-models.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m5)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>The variances appear to be somewhat unequal.</p>
</div>
<div id="normal-distribution-assumption" class="section level3 unnumbered">
<h3>Normal distribution assumption</h3>
<p>Use a Normal quantile-quantile (Q-Q) plot.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="linear-models.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(m5))</span>
<span id="cb160-2"><a href="linear-models.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(m5))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>The Normal distribution assumption does not appear to be particularly well met.</p>
<p><br></p>
<p><strong>Back to the main story …</strong></p>
<p>With balanced data, you’ll get the same results from an analysis using aov or lme. However, it’s preferable to use a mixed effects model, as recommended by Simon Wood and described here.</p>
<p><br></p>
</div>
<div id="fitted-values-and-confidence-intervals" class="section level3" number="5.3.7">
<h3><span class="header-section-number">5.3.7</span> Fitted values and confidence intervals</h3>
<p>The R package, “emmeans”, is very useful for getting means and their confidence intervals and plots of these. This package will work with models from lm, aov , lme, ….</p>
<p>Estimates and plots from the fixed effects model using averaged data and the mixed model are below.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="linear-models.html#cb161-1" aria-hidden="true" tabindex="-1"></a>m3.emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m3, <span class="sc">~</span> CO2)</span>
<span id="cb161-2"><a href="linear-models.html#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="linear-models.html#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3.emm)</span></code></pre></div>
<pre><code>##  CO2  emmean    SE df lower.CL upper.CL
##  low    1.46 0.163  4     1.01     1.91
##  high   2.67 0.163  4     2.22     3.13
## 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="linear-models.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m3.emm)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="linear-models.html#cb164-1" aria-hidden="true" tabindex="-1"></a>m5.emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m5, <span class="sc">~</span>CO2, <span class="at">mode =</span> <span class="st">&quot;satterthwaite&quot;</span>)</span>
<span id="cb164-2"><a href="linear-models.html#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="linear-models.html#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m5.emm)</span></code></pre></div>
<pre><code>##  CO2  emmean    SE   df lower.CL upper.CL
##  low    1.46 0.163 4.01     1.01     1.91
##  high   2.67 0.163 4.01     2.22     3.13
## 
## Degrees-of-freedom method: satterthwaite 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="linear-models.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m5.emm)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="another-aside---code-the-nested-structure---not-recommended" class="section level3" number="5.3.8">
<h3><span class="header-section-number">5.3.8</span> Another aside - code the nested structure - not recommended</h3>
<p>The analysis can be done with lm if the model is coded so that the nesting of trees within CO2 treatments is incorporated. It can only be done this way because, again, the data is balanced and there are no missing values. The full data set is used.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="linear-models.html#cb167-1" aria-hidden="true" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(area <span class="sc">~</span> CO2 <span class="sc">/</span> tree, <span class="at">data =</span> stomata)</span>
<span id="cb167-2"><a href="linear-models.html#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="linear-models.html#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m6)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: area
##           Df Sum Sq Mean Sq  F value    Pr(&gt;F)    
## CO2        1 8.8213  8.8213 184.5452 6.686e-11 ***
## CO2:tree   4 1.2744  0.3186   6.6654  0.001788 ** 
## Residuals 18 0.8604  0.0478                       
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>In the output above, the effect of CO2 needs to be compared against the correct residual term. The <span class="math inline">\(P\)</span> value against CO2 shown in the output is obtained by comparing the variation of CO2 treatments against the variation <em>among observations within trees</em>. This is not the correct comparison. As tree is the experimental unit (leaf is the observational unit), the correct term for the comparison is the term corresponding to the variation <em>between trees within CO2 treatments</em>. In the output, that term is CO2:tree. Consequently, the correct <span class="math inline">\(P\)</span> value for the effect of CO2 is obtained from the <span class="math inline">\(F\)</span> statistic calculated as 8.8213 / 0.3186 (i.e. (Mean Sq for CO2) / (Mean Sq for appropriate residual term)). The calculation for obtaining the <span class="math inline">\(P\)</span> value is below.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="linear-models.html#cb169-1" aria-hidden="true" tabindex="-1"></a>f_obs <span class="ot">&lt;-</span> <span class="fl">8.8213</span> <span class="sc">/</span> <span class="fl">0.3186</span></span>
<span id="cb169-2"><a href="linear-models.html#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="linear-models.html#cb169-3" aria-hidden="true" tabindex="-1"></a>f_obs</span></code></pre></div>
<pre><code>## [1] 27.6877</code></pre>
<p>This is the correct <span class="math inline">\(F\)</span> value, as seen previously.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="linear-models.html#cb171-1" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(f_obs, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb171-2"><a href="linear-models.html#cb171-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-3"><a href="linear-models.html#cb171-3" aria-hidden="true" tabindex="-1"></a>p_val</span></code></pre></div>
<pre><code>## [1] 0.00624638</code></pre>
<p>The <span class="math inline">\(P\)</span> value is also clearly the same as seen previously.</p>
<p>It could be awkward to get correct confidence intervals from this model.</p>
<p><br></p>
</div>
<div id="summary" class="section level3" number="5.3.9">
<h3><span class="header-section-number">5.3.9</span> Summary</h3>
<p>When you have subsampling (i.e. multiple measurements made on individual experimental units), use a mixed effects model.</p>
<p>If you have unequal replication across treatments or missing values, definitely use a mixed effects model.</p>
<p><br></p>
</div>
</div>
<div id="marginal-means---emmeans-example" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Marginal means - emmeans example</h2>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="linear-models.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb173-2"><a href="linear-models.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb173-3"><a href="linear-models.html#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb173-4"><a href="linear-models.html#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcmdrMisc)</span></code></pre></div>
<pre><code>## Loading required package: car</code></pre>
<pre><code>## Loading required package: carData</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:boot&#39;:
## 
##     logit</code></pre>
<pre><code>## Loading required package: sandwich</code></pre>
<p>From the document, <em>Basics of estimated marginal means</em>.</p>
<p><a href="https://cran.r-project.org/web/packages/emmeans/vignettes/basics.html" class="uri">https://cran.r-project.org/web/packages/emmeans/vignettes/basics.html</a></p>
<p>pigs {emmeans} R Documentation</p>
<p>Effects of dietary protein on free plasma leucine concentration in pigs</p>
<p>Description</p>
<p>A two-factor experiment with some observations lost</p>
<p>A data frame with 29 observations and 3 variables:</p>
<ul>
<li>source: Source of protein in the diet (factor with 3 levels: fish meal, soybean meal, dried skim milk)</li>
<li>percent: Protein percentage in the diet (numeric with 4 values: 9, 12, 15, and 18)</li>
<li>conc: Concentration of free plasma leucine, in mcg/ml</li>
</ul>
<p>Source:
Windels HF (1964) PhD thesis, Univ. of Minnesota. (Reported as Problem 10.8 in Oehlert G (2000) A First Course in Design and Analysis of Experiments, licensed under Creative Commons, <a href="http://users.stat.umn.edu/~gary/Book.html" class="uri">http://users.stat.umn.edu/~gary/Book.html</a>.) Observations 7, 22, 23, 31, 33, and 35 have been omitted, creating a more notable imbalance.</p>
<p>[Package emmeans version 1.4.6]</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="linear-models.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pigs, <span class="at">package =</span> <span class="st">&quot;emmeans&quot;</span>)</span>
<span id="cb181-2"><a href="linear-models.html#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="linear-models.html#cb181-3" aria-hidden="true" tabindex="-1"></a>pigs</span></code></pre></div>
<pre><code>##    source percent conc
## 1    fish       9 27.8
## 2    fish       9 23.7
## 3    fish      12 31.5
## 4    fish      12 28.5
## 5    fish      12 32.8
## 6    fish      15 34.0
## 7    fish      15 28.3
## 8    fish      18 30.6
## 9    fish      18 32.7
## 10   fish      18 33.7
## 11    soy       9 39.3
## 12    soy       9 34.8
## 13    soy       9 29.8
## 14    soy      12 39.8
## 15    soy      12 40.0
## 16    soy      12 39.1
## 17    soy      15 38.5
## 18    soy      15 39.2
## 19    soy      15 40.0
## 20    soy      18 42.9
## 21   skim       9 40.6
## 22   skim       9 31.0
## 23   skim       9 34.6
## 24   skim      12 42.9
## 25   skim      12 50.1
## 26   skim      12 37.4
## 27   skim      15 59.5
## 28   skim      15 41.4
## 29   skim      18 59.8</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="linear-models.html#cb183-1" aria-hidden="true" tabindex="-1"></a>pigs<span class="sc">$</span>percent <span class="ot">&lt;-</span> <span class="fu">factor</span>(pigs<span class="sc">$</span>percent)</span></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="linear-models.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">numSummary</span>(pigs[ , <span class="dv">3</span>], <span class="at">statistics =</span> <span class="st">&quot;mean&quot;</span>, </span>
<span id="cb184-2"><a href="linear-models.html#cb184-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">groups =</span> <span class="fu">interaction</span>(pigs<span class="sc">$</span>source, pigs<span class="sc">$</span>percent))</span></code></pre></div>
<pre><code>##             mean n
## fish.9  25.75000 2
## soy.9   34.63333 3
## skim.9  35.40000 3
## fish.12 30.93333 3
## soy.12  39.63333 3
## skim.12 43.46667 3
## fish.15 31.15000 2
## soy.15  39.23333 3
## skim.15 50.45000 2
## fish.18 32.33333 3
## soy.18  42.90000 1
## skim.18 59.80000 1</code></pre>
<p><br></p>
<p>Cell means (see also below)</p>
<p>These are arithmetic means of values in each two-way combination</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="linear-models.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pigs, <span class="fu">tapply</span>(conc, <span class="at">INDEX =</span> <span class="fu">list</span>(source, percent), mean))</span></code></pre></div>
<pre><code>##             9       12       15       18
## fish 25.75000 30.93333 31.15000 32.33333
## soy  34.63333 39.63333 39.23333 42.90000
## skim 35.40000 43.46667 50.45000 59.80000</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="linear-models.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pigs, <span class="fu">interaction.plot</span>(percent, source, conc))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p><br></p>
<p>Marginal means</p>
<p>Arithmetic mean of values in each “percent” group</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="linear-models.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pigs, <span class="fu">tapply</span>(conc, percent, mean))</span></code></pre></div>
<pre><code>##        9       12       15       18 
## 32.70000 38.01111 40.12857 39.94000</code></pre>
<p>Find average for percent = 15</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="linear-models.html#cb191-1" aria-hidden="true" tabindex="-1"></a>( (<span class="fl">34.0</span> <span class="sc">+</span> <span class="fl">28.3</span>) <span class="sc">+</span> (<span class="fl">38.5</span> <span class="sc">+</span> <span class="fl">39.2</span> <span class="sc">+</span> <span class="fl">40.0</span>) <span class="sc">+</span> (<span class="fl">59.5</span> <span class="sc">+</span> <span class="fl">41.4</span>) ) <span class="sc">/</span> <span class="dv">7</span></span></code></pre></div>
<pre><code>## [1] 40.12857</code></pre>
<p><br></p>
<p>Cell means</p>
<p>Arithmetic means of values in each combination - same as above with two-way tapply call</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="linear-models.html#cb193-1" aria-hidden="true" tabindex="-1"></a>cell.means <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">with</span>(pigs, </span>
<span id="cb193-2"><a href="linear-models.html#cb193-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tapply</span>(conc, <span class="fu">interaction</span>(source, percent), mean)), </span>
<span id="cb193-3"><a href="linear-models.html#cb193-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb193-4"><a href="linear-models.html#cb193-4" aria-hidden="true" tabindex="-1"></a>cell.means</span></code></pre></div>
<pre><code>##          [,1]     [,2]     [,3]     [,4]
## [1,] 25.75000 30.93333 31.15000 32.33333
## [2,] 34.63333 39.63333 39.23333 42.90000
## [3,] 35.40000 43.46667 50.45000 59.80000</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="linear-models.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(cell.means, <span class="dv">2</span>, mean)</span></code></pre></div>
<pre><code>## [1] 31.92778 38.01111 40.27778 45.01111</code></pre>
<p>Compare with arithmetic mean of values in each “percent” group</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="linear-models.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pigs, <span class="fu">tapply</span>(conc, percent, mean))</span></code></pre></div>
<pre><code>##        9       12       15       18 
## 32.70000 38.01111 40.12857 39.94000</code></pre>
<p>The two sets are different because the different cells do not all have the same number of observations (some observations were lost).</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="linear-models.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pigs, <span class="fu">table</span>(source, percent))</span></code></pre></div>
<pre><code>##       percent
## source 9 12 15 18
##   fish 2  3  2  3
##   soy  3  3  3  1
##   skim 3  3  2  1</code></pre>
<p>The marginal mean for percent = 12 is the same as the average of the cell means because no observations were lost - i.e. there are equal weights on all the cell means.</p>
<p><br></p>
<p>We can reproduce the <em>marginal means</em> by weighting the cell means with these frequencies. For example, in the last column:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="linear-models.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> cell.means[ , <span class="dv">4</span>]) <span class="sc">/</span> <span class="dv">5</span></span></code></pre></div>
<pre><code>## [1] 39.94</code></pre>
<p><br></p>
</div>
<div id="multiple-regression-example" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Multiple regression example</h2>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="linear-models.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb203-2"><a href="linear-models.html#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb203-3"><a href="linear-models.html#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;GGally&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<pre><code>## 
## Attaching package: &#39;GGally&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     pigs</code></pre>
<pre><code>## The following object is masked from &#39;package:emmeans&#39;:
## 
##     pigs</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="linear-models.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;parameters&#39;:
##   method                           from      
##   as.double.parameters_kurtosis    datawizard
##   as.double.parameters_skewness    datawizard
##   as.double.parameters_smoothness  datawizard
##   as.numeric.parameters_kurtosis   datawizard
##   as.numeric.parameters_skewness   datawizard
##   as.numeric.parameters_smoothness datawizard
##   print.parameters_distribution    datawizard
##   print.parameters_kurtosis        datawizard
##   print.parameters_skewness        datawizard
##   summary.parameters_kurtosis      datawizard
##   summary.parameters_skewness      datawizard</code></pre>
<pre><code>## #refugeeswelcome</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="linear-models.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb211-2"><a href="linear-models.html#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span></code></pre></div>
<p>Example from StatSci.org - OzDASL, Australian Institute of Sport</p>
<p><a href="http://www.statsci.org/data/oz/ais.html" class="uri">http://www.statsci.org/data/oz/ais.html</a></p>
<p>Variable Description</p>
<p>Sport Sport
Sex male or female
Ht Height in cm
Wt Weight in kg
LBM Lean body mass
RCC Red cell count
WCC White cell count
Hc Hematocrit
Hg Hemoglobin
Ferr Plasma ferritin concentration
BMI Body mass index = weight/height^2
SSF Sum of skin folds
%Bfat % body fat</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="linear-models.html#cb212-1" aria-hidden="true" tabindex="-1"></a>athletes <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;http://www.statsci.org/data/oz/ais.txt&quot;</span>, </span>
<span id="cb212-2"><a href="linear-models.html#cb212-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sep =</span> <span class="st">&quot;&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb212-3"><a href="linear-models.html#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="linear-models.html#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(athletes)</span>
<span id="cb212-5"><a href="linear-models.html#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="linear-models.html#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(athletes, <span class="at">file =</span> <span class="st">&quot;athletes_OzDASL.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="linear-models.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/athletes_OzDASL.Rdata&quot;</span>)</span>
<span id="cb213-2"><a href="linear-models.html#cb213-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-3"><a href="linear-models.html#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(athletes)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    202 obs. of  13 variables:
##  $ Sex   : chr  &quot;female&quot; &quot;female&quot; &quot;female&quot; &quot;female&quot; ...
##  $ Sport : chr  &quot;BBall&quot; &quot;BBall&quot; &quot;BBall&quot; &quot;BBall&quot; ...
##  $ RCC   : num  3.96 4.41 4.14 4.11 4.45 4.1 4.31 4.42 4.3 4.51 ...
##  $ WCC   : num  7.5 8.3 5 5.3 6.8 4.4 5.3 5.7 8.9 4.4 ...
##  $ Hc    : num  37.5 38.2 36.4 37.3 41.5 37.4 39.6 39.9 41.1 41.6 ...
##  $ Hg    : num  12.3 12.7 11.6 12.6 14 12.5 12.8 13.2 13.5 12.7 ...
##  $ Ferr  : int  60 68 21 69 29 42 73 44 41 44 ...
##  $ BMI   : num  20.6 20.7 21.9 21.9 19 ...
##  $ SSF   : num  109.1 102.8 104.6 126.4 80.3 ...
##  $ X.Bfat: num  19.8 21.3 19.9 23.7 17.6 ...
##  $ LBM   : num  63.3 58.5 55.4 57.2 53.2 ...
##  $ Ht    : num  196 190 178 185 185 ...
##  $ Wt    : num  78.9 74.4 69.1 74.9 64.6 63.7 75.2 62.3 66.5 62.9 ...</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="linear-models.html#cb215-1" aria-hidden="true" tabindex="-1"></a>athletes<span class="sc">$</span>Sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(athletes<span class="sc">$</span>Sex)</span>
<span id="cb215-2"><a href="linear-models.html#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="linear-models.html#cb215-3" aria-hidden="true" tabindex="-1"></a>athletes<span class="sc">$</span>Sport <span class="ot">&lt;-</span> <span class="fu">factor</span>(athletes<span class="sc">$</span>Sport)</span>
<span id="cb215-4"><a href="linear-models.html#cb215-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-5"><a href="linear-models.html#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="co">#names( athletes )[names(athletes) == &quot;X.Bfat&quot;] &lt;- &quot;Bfat_pc&quot;</span></span>
<span id="cb215-6"><a href="linear-models.html#cb215-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-7"><a href="linear-models.html#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  or</span></span>
<span id="cb215-8"><a href="linear-models.html#cb215-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-9"><a href="linear-models.html#cb215-9" aria-hidden="true" tabindex="-1"></a>athletes <span class="ot">&lt;-</span> athletes <span class="sc">%&gt;%</span> <span class="fu">rename</span>( <span class="at">Bfat_pc =</span> X.Bfat)</span></code></pre></div>
<div id="regression-model" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Regression model</h3>
<p>Response: LBM</p>
<p>Predictors:</p>
<ul>
<li>height</li>
<li>weight</li>
<li>gender</li>
<li>Ferr</li>
</ul>
<p>Include log(Ferr) as suggested on OzDASL web page.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="linear-models.html#cb216-1" aria-hidden="true" tabindex="-1"></a>athletes<span class="sc">$</span>log_Ferr <span class="ot">&lt;-</span> <span class="fu">log</span>(athletes<span class="sc">$</span>Ferr)</span></code></pre></div>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="linear-models.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(athletes, <span class="at">columns =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">14</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">11</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="linear-models.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(athletes, <span class="fu">aes</span>(<span class="at">x =</span> Sex, <span class="at">y =</span> LBM)) <span class="sc">+</span></span>
<span id="cb218-2"><a href="linear-models.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="linear-models.html#cb219-1" aria-hidden="true" tabindex="-1"></a>ath.lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(LBM <span class="sc">~</span> Ht <span class="sc">+</span> Wt <span class="sc">+</span>log_Ferr <span class="sc">+</span> Sex, <span class="at">data =</span> athletes)</span>
<span id="cb219-2"><a href="linear-models.html#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="linear-models.html#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ath.lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = LBM ~ Ht + Wt + log_Ferr + Sex, data = athletes)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -11.9543  -1.5237   0.2123   1.6439   8.8396 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1.30242    5.49116  -0.237   0.8128    
## Ht           0.08320    0.03400   2.447   0.0153 *  
## Wt           0.65455    0.02326  28.141   &lt;2e-16 ***
## log_Ferr    -0.61689    0.35494  -1.738   0.0838 .  
## Sexmale      9.23148    0.51135  18.053   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.713 on 197 degrees of freedom
## Multiple R-squared:  0.9578, Adjusted R-squared:  0.9569 
## F-statistic:  1117 on 4 and 197 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="linear-models.html#cb221-1" aria-hidden="true" tabindex="-1"></a>ath.lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(LBM <span class="sc">~</span> Ht , <span class="at">data =</span> athletes)</span>
<span id="cb221-2"><a href="linear-models.html#cb221-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-3"><a href="linear-models.html#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ath.lm2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = LBM ~ Ht, data = athletes)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -18.566  -4.913  -0.556   4.171  31.853 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -129.0947    10.2259  -12.62   &lt;2e-16 ***
## Ht             1.0770     0.0567   19.00   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.825 on 200 degrees of freedom
## Multiple R-squared:  0.6434, Adjusted R-squared:  0.6416 
## F-statistic: 360.8 on 1 and 200 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="linear-models.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb223-2"><a href="linear-models.html#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ath.lm1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-107-1.png" width="672" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="linear-models.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="linear-models.html#cb225-1" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(ath.lm1, <span class="at">type =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">terms =</span> <span class="st">&quot;Ht&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-2"><a href="linear-models.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted values of mean LBM with 95 % confidence band&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-3"><a href="linear-models.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb225-4"><a href="linear-models.html#cb225-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-5"><a href="linear-models.html#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-108-1.png" width="480" /></p>
<p>The plot above shows a confidence band for predicted mean LBM, as seen by comparing the intervals below with the output of the “predict” function further below.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="linear-models.html#cb226-1" aria-hidden="true" tabindex="-1"></a>plot1<span class="sc">$</span>data</span></code></pre></div>
<pre><code>## # Predicted values of LBM
## 
##  Ht | Predicted | group_col |         95% CI
## --------------------------------------------
## 140 |     56.88 |         1 | [54.30, 59.45]
## 150 |     57.71 |         1 | [55.78, 59.64]
## 160 |     58.54 |         1 | [57.22, 59.86]
## 170 |     59.37 |         1 | [58.59, 60.16]
## 180 |     60.20 |         1 | [59.58, 60.83]
## 190 |     61.04 |         1 | [60.01, 62.06]
## 200 |     61.87 |         1 | [60.25, 63.48]
## 210 |     62.70 |         1 | [60.45, 64.95]
## 
## Adjusted for:
## *       Wt =  75.01
## * log_Ferr =   4.16
## *      Sex = female</code></pre>
<p><br></p>
<p>Confidence band - band for fitted mean</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="linear-models.html#cb228-1" aria-hidden="true" tabindex="-1"></a>X_new <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">Ht =</span> <span class="dv">14</span><span class="sc">:</span><span class="dv">21</span><span class="sc">*</span><span class="dv">10</span>, <span class="at">Wt =</span> <span class="fl">75.01</span>, <span class="at">log_Ferr =</span> <span class="fl">4.16</span>, </span>
<span id="cb228-2"><a href="linear-models.html#cb228-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Sex =</span> <span class="st">&quot;female&quot;</span>)</span>
<span id="cb228-3"><a href="linear-models.html#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="linear-models.html#cb228-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-5"><a href="linear-models.html#cb228-5" aria-hidden="true" tabindex="-1"></a>ath.lm1.pred.CI <span class="ot">&lt;-</span> <span class="fu">predict</span>(ath.lm1, <span class="at">newdata =</span> X_new, <span class="at">se.fit =</span> T, </span>
<span id="cb228-6"><a href="linear-models.html#cb228-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb228-7"><a href="linear-models.html#cb228-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb228-8"><a href="linear-models.html#cb228-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-9"><a href="linear-models.html#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Ht =</span> <span class="dv">14</span><span class="sc">:</span><span class="dv">21</span><span class="sc">*</span><span class="dv">10</span>, <span class="at">se =</span> ath.lm1.pred.CI<span class="sc">$</span>se.fit, </span>
<span id="cb228-10"><a href="linear-models.html#cb228-10" aria-hidden="true" tabindex="-1"></a>           ath.lm1.pred.CI<span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>##    Ht        se      fit      lwr      upr
## 1 140 1.3130285 56.87714 54.28775 59.46654
## 2 150 0.9858112 57.70914 55.76505 59.65324
## 3 160 0.6714313 58.54115 57.21703 59.86526
## 4 170 0.4012888 59.37315 58.58177 60.16452
## 5 180 0.3200962 60.20515 59.57389 60.83640
## 6 190 0.5245063 61.03715 60.00278 62.07152
## 7 200 0.8239954 61.86915 60.24417 63.49414
## 8 210 1.1463186 62.70115 60.44052 64.96178</code></pre>
<p>Prediction band - band for single prediction</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="linear-models.html#cb230-1" aria-hidden="true" tabindex="-1"></a>ath.lm1.pred.PI <span class="ot">&lt;-</span> <span class="fu">predict</span>(ath.lm1, <span class="at">newdata =</span> X_new, <span class="at">se.fit =</span> T, </span>
<span id="cb230-2"><a href="linear-models.html#cb230-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb230-3"><a href="linear-models.html#cb230-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb230-4"><a href="linear-models.html#cb230-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-5"><a href="linear-models.html#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Ht =</span> <span class="dv">14</span><span class="sc">:</span><span class="dv">21</span><span class="sc">*</span><span class="dv">10</span>, <span class="at">se =</span> ath.lm1.pred.PI<span class="sc">$</span>se.fit, </span>
<span id="cb230-6"><a href="linear-models.html#cb230-6" aria-hidden="true" tabindex="-1"></a>           ath.lm1.pred.PI<span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>##    Ht        se      fit      lwr      upr
## 1 140 1.3130285 56.87714 50.93353 62.82075
## 2 150 0.9858112 57.70914 52.01695 63.40134
## 3 160 0.6714313 58.54115 53.02981 64.05248
## 4 170 0.4012888 59.37315 53.96502 64.78127
## 5 180 0.3200962 60.20515 54.81812 65.59217
## 6 190 0.5245063 61.03715 55.58816 66.48614
## 7 200 0.8239954 61.86915 56.27790 67.46040
## 8 210 1.1463186 62.70115 56.89323 68.50908</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="linear-models.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> athletes, <span class="fu">aes</span>(<span class="at">x =</span> Ht, <span class="at">y =</span> LBM)) <span class="sc">+</span></span>
<span id="cb232-2"><a href="linear-models.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="linear-models.html#cb233-1" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(ath.lm1, <span class="at">type =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">terms =</span> <span class="st">&quot;Wt&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-2"><a href="linear-models.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted values of mean LBM with 95 % confidence band&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-3"><a href="linear-models.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb233-4"><a href="linear-models.html#cb233-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-5"><a href="linear-models.html#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-113-1.png" width="480" /></p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="linear-models.html#cb234-1" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(ath.lm1, <span class="at">type =</span> <span class="st">&quot;pred&quot;</span>, </span>
<span id="cb234-2"><a href="linear-models.html#cb234-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">terms =</span> <span class="st">&quot;log_Ferr&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-3"><a href="linear-models.html#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted values of mean LBM with 95 % confidence band&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-4"><a href="linear-models.html#cb234-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb234-5"><a href="linear-models.html#cb234-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-6"><a href="linear-models.html#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot3)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-114-1.png" width="480" /></p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="linear-models.html#cb235-1" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(ath.lm1, <span class="at">type =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">terms =</span> <span class="st">&quot;Sex&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-2"><a href="linear-models.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted values of mean LBM with 95 % confidence band&quot;</span>) <span class="sc">+</span></span>
<span id="cb235-3"><a href="linear-models.html#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb235-4"><a href="linear-models.html#cb235-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-5"><a href="linear-models.html#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot4)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-115-1.png" width="480" /></p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="linear-models.html#cb236-1" aria-hidden="true" tabindex="-1"></a>plot4<span class="sc">$</span>data</span></code></pre></div>
<pre><code>## # Predicted values of LBM
## 
## Sex | Predicted | group_col |         95% CI
## --------------------------------------------
##   1 |     60.21 |         1 | [59.58, 60.84]
##   2 |     69.44 |         1 | [68.82, 70.07]
## 
## Adjusted for:
## *       Ht = 180.10
## *       Wt =  75.01
## * log_Ferr =   4.16</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="linear-models.html#cb238-1" aria-hidden="true" tabindex="-1"></a>plot_all <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(plot1, plot2, plot3, plot4, <span class="at">nrow =</span> <span class="dv">2</span>, </span>
<span id="cb238-2"><a href="linear-models.html#cb238-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb238-3"><a href="linear-models.html#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="linear-models.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_all)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-117-1.png" width="672" /></p>
<p>To export the plot as a pdf (not run):</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="linear-models.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;_plots exported/athletes_reg_plot_panel.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">7</span>, </span>
<span id="cb239-2"><a href="linear-models.html#cb239-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb239-3"><a href="linear-models.html#cb239-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-4"><a href="linear-models.html#cb239-4" aria-hidden="true" tabindex="-1"></a>plot_all</span>
<span id="cb239-5"><a href="linear-models.html#cb239-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-6"><a href="linear-models.html#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p><br></p>
</div>
</div>
<div id="residual-plots---redres" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Residual plots - redres</h2>
<p><code>redres</code> package</p>
<p><a href="https://goodekat.github.io/redres/index.html" class="uri">https://goodekat.github.io/redres/index.html</a></p>
</div>
<div id="interactions---examples" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Interactions - examples</h2>
<p>Example taken from UCLA IDRE Stata examples.</p>
<p><a href="https://stats.idre.ucla.edu/stata/webbooks/reg/chapter7/regressionwith-statachapter-7-more-on-interactions-of-categorical-and-continuous-variables/" class="uri">https://stats.idre.ucla.edu/stata/webbooks/reg/chapter7/regressionwith-statachapter-7-more-on-interactions-of-categorical-and-continuous-variables/</a></p>
<p>Data file is elemapi2.csv.</p>
<p><em>Description of some variables</em></p>
<p>Academic performance of the school (api00), the average class size in kindergarten through 3rd grade (acs_k3), the percentage of students receiving free meals (meals) – which is an indicator of poverty, and the percentage of teachers who have full teaching credentials (full).</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="linear-models.html#cb240-1" aria-hidden="true" tabindex="-1"></a>reg1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/elemapi2.csv&quot;</span>)</span>
<span id="cb240-2"><a href="linear-models.html#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="linear-models.html#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(reg1)</span></code></pre></div>
<pre><code>##  [1] &quot;snum&quot;     &quot;dnum&quot;     &quot;api00&quot;    &quot;api99&quot;    &quot;growth&quot;   &quot;meals&quot;   
##  [7] &quot;ell&quot;      &quot;yr_rnd&quot;   &quot;mobility&quot; &quot;acs_k3&quot;   &quot;acs_46&quot;   &quot;not_hsg&quot; 
## [13] &quot;hsg&quot;      &quot;some_col&quot; &quot;col_grad&quot; &quot;grad_sch&quot; &quot;avg_ed&quot;   &quot;full&quot;    
## [19] &quot;emer&quot;     &quot;enroll&quot;   &quot;mealcat&quot;  &quot;collcat&quot;</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="linear-models.html#cb242-1" aria-hidden="true" tabindex="-1"></a>reg1<span class="sc">$</span>collcat <span class="ot">&lt;-</span> <span class="fu">factor</span>(reg1<span class="sc">$</span>collcat)</span>
<span id="cb242-2"><a href="linear-models.html#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="linear-models.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="fu">relevel</span>(reg1<span class="sc">$</span>collcat, <span class="at">ref =</span> <span class="st">&quot;1&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="linear-models.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(reg1<span class="sc">$</span>api00 <span class="sc">~</span> reg1<span class="sc">$</span>collcat, </span>
<span id="cb243-2"><a href="linear-models.html#cb243-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;collcat&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;api00&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-121-1.png" width="672" /></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="linear-models.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reg1<span class="sc">$</span>api00 <span class="sc">~</span> reg1<span class="sc">$</span>meals, </span>
<span id="cb244-2"><a href="linear-models.html#cb244-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;meals&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;api00&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
<p><strong>Model with equal slopes for the “collcat” level lines</strong></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="linear-models.html#cb245-1" aria-hidden="true" tabindex="-1"></a>api00.lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(api00 <span class="sc">~</span> collcat <span class="sc">+</span> meals, <span class="at">data =</span> reg1)</span>
<span id="cb245-2"><a href="linear-models.html#cb245-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-3"><a href="linear-models.html#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(api00.lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = api00 ~ collcat + meals, data = reg1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -204.742  -43.655   -2.151   39.005  179.714 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 872.42724    8.77485  99.424  &lt; 2e-16 ***
## collcat2     14.01454    7.62786   1.837  0.06692 .  
## collcat3     24.24049    7.72798   3.137  0.00184 ** 
## meals        -3.94267    0.09883 -39.892  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 61.27 on 396 degrees of freedom
## Multiple R-squared:  0.8159, Adjusted R-squared:  0.8145 
## F-statistic: 584.8 on 3 and 396 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="linear-models.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb247-2"><a href="linear-models.html#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(api00.lm1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="linear-models.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb248-2"><a href="linear-models.html#cb248-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-3"><a href="linear-models.html#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Assumptions satisfied</span></span></code></pre></div>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="linear-models.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg1<span class="sc">$</span>meals)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    0.00   31.00   67.50   60.31   90.00  100.00</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="linear-models.html#cb251-1" aria-hidden="true" tabindex="-1"></a>newdd <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">collcat =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb251-2"><a href="linear-models.html#cb251-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">meals =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>))</span>
<span id="cb251-3"><a href="linear-models.html#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(newdd)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    303 obs. of  2 variables:
##  $ collcat: int  1 2 3 1 2 3 1 2 3 1 ...
##  $ meals  : int  0 0 0 1 1 1 2 2 2 3 ...
##  - attr(*, &quot;out.attrs&quot;)=List of 2
##   ..$ dim     : Named int [1:2] 3 101
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;collcat&quot; &quot;meals&quot;
##   ..$ dimnames:List of 2
##   .. ..$ collcat: chr [1:3] &quot;collcat=1&quot; &quot;collcat=2&quot; &quot;collcat=3&quot;
##   .. ..$ meals  : chr [1:101] &quot;meals=  0&quot; &quot;meals=  1&quot; &quot;meals=  2&quot; &quot;meals=  3&quot; ...</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="linear-models.html#cb253-1" aria-hidden="true" tabindex="-1"></a>newdd<span class="sc">$</span>collcat <span class="ot">&lt;-</span> <span class="fu">factor</span>(newdd<span class="sc">$</span>collcat)</span>
<span id="cb253-2"><a href="linear-models.html#cb253-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-3"><a href="linear-models.html#cb253-3" aria-hidden="true" tabindex="-1"></a>yhat1.api00 <span class="ot">&lt;-</span> <span class="fu">predict</span>(api00.lm1, <span class="at">newdata =</span> newdd)</span>
<span id="cb253-4"><a href="linear-models.html#cb253-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-5"><a href="linear-models.html#cb253-5" aria-hidden="true" tabindex="-1"></a>pred1.plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(newdd, <span class="at">yhat1 =</span> yhat1.api00))</span></code></pre></div>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="linear-models.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  Plot using &quot;xyplot&quot;</span></span>
<span id="cb254-2"><a href="linear-models.html#cb254-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-3"><a href="linear-models.html#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(yhat1 <span class="sc">~</span> meals, <span class="at">groups =</span> collcat, <span class="at">data =</span> pred1.plot,</span>
<span id="cb254-4"><a href="linear-models.html#cb254-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb254-5"><a href="linear-models.html#cb254-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">lines =</span> T, <span class="at">points =</span> F, <span class="at">title =</span> <span class="st">&quot;collcat&quot;</span>,</span>
<span id="cb254-6"><a href="linear-models.html#cb254-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">space =</span> <span class="st">&quot;top&quot;</span>, <span class="at">columns =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="linear-models.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  Plot using base graphics - &quot;plot&quot;</span></span>
<span id="cb255-2"><a href="linear-models.html#cb255-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-3"><a href="linear-models.html#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred1.plot[pred1.plot<span class="sc">$</span>collcat <span class="sc">==</span> <span class="st">&quot;1&quot;</span>, ],</span>
<span id="cb255-4"><a href="linear-models.html#cb255-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot</span>(meals, yhat1, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, </span>
<span id="cb255-5"><a href="linear-models.html#cb255-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(pred1.plot<span class="sc">$</span>yhat1), <span class="fu">max</span>(pred1.plot<span class="sc">$</span>yhat1))))</span>
<span id="cb255-6"><a href="linear-models.html#cb255-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-7"><a href="linear-models.html#cb255-7" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred1.plot[pred1.plot<span class="sc">$</span>collcat <span class="sc">==</span> <span class="st">&quot;2&quot;</span>, ],</span>
<span id="cb255-8"><a href="linear-models.html#cb255-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">lines</span>(meals, yhat1, <span class="at">lty =</span> <span class="dv">2</span>))</span>
<span id="cb255-9"><a href="linear-models.html#cb255-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-10"><a href="linear-models.html#cb255-10" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred1.plot[pred1.plot<span class="sc">$</span>collcat <span class="sc">==</span> <span class="st">&quot;3&quot;</span>, ],</span>
<span id="cb255-11"><a href="linear-models.html#cb255-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">lines</span>(meals, yhat1, <span class="at">lty =</span> <span class="dv">3</span>))</span>
<span id="cb255-12"><a href="linear-models.html#cb255-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-13"><a href="linear-models.html#cb255-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="dv">90</span>, <span class="at">y =</span> <span class="dv">890</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>),</span>
<span id="cb255-14"><a href="linear-models.html#cb255-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;collcat&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">0.6</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="linear-models.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb256-2"><a href="linear-models.html#cb256-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-3"><a href="linear-models.html#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred1.plot, <span class="fu">aes</span>(meals, yhat1, <span class="at">group =</span> collcat)) <span class="sc">+</span> </span>
<span id="cb256-4"><a href="linear-models.html#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> collcat, <span class="at">linetype =</span> collcat))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-128-1.png" width="672" /></p>
<p><strong>Model with different slopes for the “collcat” level lines</strong></p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="linear-models.html#cb257-1" aria-hidden="true" tabindex="-1"></a>api00.lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(api00 <span class="sc">~</span> collcat <span class="sc">*</span> meals, <span class="at">data =</span> reg1)</span>
<span id="cb257-2"><a href="linear-models.html#cb257-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-3"><a href="linear-models.html#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(api00.lm2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = api00 ~ collcat * meals, data = reg1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -202.159  -41.028   -2.995   37.888  162.297 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    886.13253   12.08177  73.345  &lt; 2e-16 ***
## collcat2        10.29492   16.24717   0.634  0.52668    
## collcat3       -21.28174   16.87625  -1.261  0.20804    
## meals           -4.13839    0.15484 -26.726  &lt; 2e-16 ***
## collcat2:meals   0.02815    0.22250   0.127  0.89939    
## collcat3:meals   0.80897    0.25616   3.158  0.00171 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 60.53 on 394 degrees of freedom
## Multiple R-squared:  0.8212, Adjusted R-squared:  0.8189 
## F-statistic: 361.9 on 5 and 394 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Test significance of interaction</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="linear-models.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(api00.lm1, api00.lm2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: api00 ~ collcat + meals
## Model 2: api00 ~ collcat * meals
##   Res.Df     RSS Df Sum of Sq      F   Pr(&gt;F)   
## 1    396 1486720                                
## 2    394 1443742  2     42978 5.8644 0.003092 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="linear-models.html#cb261-1" aria-hidden="true" tabindex="-1"></a>yhat2.api00 <span class="ot">&lt;-</span> <span class="fu">predict</span>(api00.lm2, <span class="at">newdata =</span> newdd)</span>
<span id="cb261-2"><a href="linear-models.html#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="linear-models.html#cb261-3" aria-hidden="true" tabindex="-1"></a>pred2.plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(newdd, <span class="at">yhat2 =</span> yhat2.api00))</span></code></pre></div>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="linear-models.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred2.plot, <span class="fu">aes</span>(meals, yhat2, <span class="at">group =</span> collcat)) <span class="sc">+</span> </span>
<span id="cb262-2"><a href="linear-models.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> collcat, <span class="at">linetype =</span> collcat))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<p>Compare slopes:</p>
<ul>
<li><p>3 vs. 1 and 2</p></li>
<li><p>2 vs 1</p></li>
</ul>
<p>Need to do this using contrast matrix.</p>
</div>
<div id="interaction-plot-in-ggplot2" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> Interaction plot in ggplot2</h2>
<p><em>Formatting is pretty heavy but was done this way for someone</em></p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="linear-models.html#cb263-1" aria-hidden="true" tabindex="-1"></a>totalC <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/total carbon.csv&quot;</span>)</span>
<span id="cb263-2"><a href="linear-models.html#cb263-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-3"><a href="linear-models.html#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(totalC)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    28 obs. of  4 variables:
##  $ TC_mgl   : num  88.6 96.4 97.6 114 114 ...
##  $ Treatment: chr  &quot;Control&quot; &quot;NPK&quot; &quot;NPK&quot; &quot;NPK&quot; ...
##  $ Day      : int  5 5 5 5 5 5 5 15 15 15 ...
##  $ Tube     : int  1 2 3 4 5 6 7 1 2 3 ...</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="linear-models.html#cb265-1" aria-hidden="true" tabindex="-1"></a>ixn.plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> totalC, </span>
<span id="cb265-2"><a href="linear-models.html#cb265-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> Day, <span class="at">y =</span> TC_mgl, <span class="at">group =</span> Treatment, </span>
<span id="cb265-3"><a href="linear-models.html#cb265-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> Treatment)) <span class="sc">+</span></span>
<span id="cb265-4"><a href="linear-models.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>) <span class="sc">+</span></span>
<span id="cb265-5"><a href="linear-models.html#cb265-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb265-6"><a href="linear-models.html#cb265-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Total C Concentration (mg/L)&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: `fun.y` is deprecated. Use `fun` instead.

## Warning: `fun.y` is deprecated. Use `fun` instead.</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="linear-models.html#cb267-1" aria-hidden="true" tabindex="-1"></a>ixn.plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb267-2"><a href="linear-models.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>), </span>
<span id="cb267-3"><a href="linear-models.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb267-4"><a href="linear-models.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb267-5"><a href="linear-models.html#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, </span>
<span id="cb267-6"><a href="linear-models.html#cb267-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb267-7"><a href="linear-models.html#cb267-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
</div>
<div id="plot-simple-linear-regression-fitted-line-with-95-confidence-band" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> Plot simple linear regression fitted line with 95 % confidence band</h2>
<p>Two examples: Jake’s cycling data and David’s water quality data</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="linear-models.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  Jake&#39;s cycling data</span></span>
<span id="cb268-2"><a href="linear-models.html#cb268-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-3"><a href="linear-models.html#cb268-3" aria-hidden="true" tabindex="-1"></a>cycle <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/cycling.txt&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb268-4"><a href="linear-models.html#cb268-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-5"><a href="linear-models.html#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cycle)</span></code></pre></div>
<pre><code>##     vehicle          colour       pass_distance       street     
##  Min.   :1.000   Min.   : 1.000   Min.   :0.394   Min.   :1.000  
##  1st Qu.:1.000   1st Qu.: 1.000   1st Qu.:1.303   1st Qu.:3.000  
##  Median :1.000   Median : 3.000   Median :1.529   Median :5.000  
##  Mean   :1.634   Mean   : 3.556   Mean   :1.564   Mean   :4.396  
##  3rd Qu.:2.000   3rd Qu.: 4.000   3rd Qu.:1.790   3rd Qu.:5.000  
##  Max.   :7.000   Max.   :99.000   Max.   :3.787   Max.   :6.000  
##      Time               hour               helmet      
##  Length:2355        Length:2355        Min.   :0.0000  
##  Class :character   Class :character   1st Qu.:0.0000  
##  Mode  :character   Mode  :character   Median :0.0000  
##                                        Mean   :0.4879  
##                                        3rd Qu.:1.0000  
##                                        Max.   :1.0000  
##       kerb           Bikelane            City      
##  Min.   :0.2500   Min.   :0.00000   Min.   :1.000  
##  1st Qu.:0.2500   1st Qu.:0.00000   1st Qu.:1.000  
##  Median :0.5000   Median :0.00000   Median :1.000  
##  Mean   :0.6702   Mean   :0.02123   Mean   :1.191  
##  3rd Qu.:1.0000   3rd Qu.:0.00000   3rd Qu.:1.000  
##  Max.   :1.2500   Max.   :1.00000   Max.   :2.000  
##      date          
##  Length:2355       
##  Class :character  
##  Mode  :character  
##                    
##                    
## </code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="linear-models.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(cycle, <span class="fu">plot</span>(pass_distance <span class="sc">~</span> kerb, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="linear-models.html#cb271-1" aria-hidden="true" tabindex="-1"></a>reg.kerb <span class="ot">&lt;-</span> <span class="fu">lm</span>(pass_distance <span class="sc">~</span> kerb, <span class="at">data =</span> cycle)</span>
<span id="cb271-2"><a href="linear-models.html#cb271-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-3"><a href="linear-models.html#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg.kerb)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pass_distance ~ kerb, data = cycle)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.28553 -0.24834 -0.03416  0.20266  2.38263 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.74832    0.01628  107.40   &lt;2e-16 ***
## kerb        -0.27516    0.02145  -12.83   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3708 on 2353 degrees of freedom
## Multiple R-squared:  0.06538,    Adjusted R-squared:  0.06498 
## F-statistic: 164.6 on 1 and 2353 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="linear-models.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(cycle<span class="sc">$</span>kerb)</span></code></pre></div>
<pre><code>## [1] 0.25 1.25</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="linear-models.html#cb275-1" aria-hidden="true" tabindex="-1"></a>kerbnew <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">kerb =</span> <span class="fu">seq</span>(<span class="fl">0.25</span>, <span class="fl">1.25</span>, <span class="at">by =</span> <span class="fl">0.05</span>))</span>
<span id="cb275-2"><a href="linear-models.html#cb275-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-3"><a href="linear-models.html#cb275-3" aria-hidden="true" tabindex="-1"></a>ypred <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg.kerb, <span class="at">newdata =</span> kerbnew, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb275-4"><a href="linear-models.html#cb275-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-5"><a href="linear-models.html#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ypred)</span></code></pre></div>
<pre><code>##  num [1:21, 1:3] 1.68 1.67 1.65 1.64 1.62 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:21] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   ..$ : chr [1:3] &quot;fit&quot; &quot;lwr&quot; &quot;upr&quot;</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="linear-models.html#cb277-1" aria-hidden="true" tabindex="-1"></a>ypred[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, ]</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 1.679526 1.656358 1.702695
## 2 1.665768 1.644161 1.687376
## 3 1.652010 1.631865 1.672155
## 4 1.638252 1.619448 1.657057
## 5 1.624494 1.606881 1.642108
## 6 1.610736 1.594131 1.627341
## 7 1.596978 1.581166 1.612791
## 8 1.583220 1.567949 1.598491</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="linear-models.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(ypred[ , <span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 1.404365 1.679526</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="linear-models.html#cb281-1" aria-hidden="true" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lower =</span> ypred[ , <span class="st">&quot;lwr&quot;</span>], <span class="at">upper =</span> ypred[ , <span class="st">&quot;upr&quot;</span>])</span>
<span id="cb281-2"><a href="linear-models.html#cb281-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-3"><a href="linear-models.html#cb281-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(cycle, <span class="fu">plot</span>(pass_distance <span class="sc">~</span> kerb, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="linear-models.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ypred[ , <span class="dv">1</span>] <span class="sc">~</span> kerbnew<span class="sc">$</span>kerb, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), </span>
<span id="cb282-2"><a href="linear-models.html#cb282-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.4</span>, <span class="fl">1.7</span>))</span>
<span id="cb282-3"><a href="linear-models.html#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(kerbnew<span class="sc">$</span>kerb, ci<span class="sc">$</span>lower, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb282-4"><a href="linear-models.html#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(kerbnew<span class="sc">$</span>kerb, ci<span class="sc">$</span>upper, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<p><em>David’s water quality data</em></p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="linear-models.html#cb283-1" aria-hidden="true" tabindex="-1"></a>waterQual <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/waterQual.txt&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb283-2"><a href="linear-models.html#cb283-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-3"><a href="linear-models.html#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="co">#save(cycle, waterQual, file = &quot;lm pred confidence band.RData&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="linear-models.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(waterQual)</span></code></pre></div>
<pre><code>##    catchment       quality     
##  Min.   : 5.0   Min.   :29.00  
##  1st Qu.:16.0   1st Qu.:45.25  
##  Median :26.0   Median :57.50  
##  Mean   :25.0   Mean   :61.30  
##  3rd Qu.:29.5   3rd Qu.:82.00  
##  Max.   :57.0   Max.   :89.00</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="linear-models.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(waterQual)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    20 obs. of  2 variables:
##  $ catchment: int  29 49 28 8 57 9 31 10 21 26 ...
##  $ quality  : int  61 85 46 53 55 71 59 41 82 56 ...</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="linear-models.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.axis =</span> <span class="fl">0.9</span>)</span>
<span id="cb288-2"><a href="linear-models.html#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(waterQual<span class="sc">$</span>quality <span class="sc">~</span> waterQual<span class="sc">$</span>catchment, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>), </span>
<span id="cb288-3"><a href="linear-models.html#cb288-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">105</span>), <span class="at">frame =</span> T)</span>
<span id="cb288-4"><a href="linear-models.html#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span><span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb288-5"><a href="linear-models.html#cb288-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-146-1.png" width="672" /></p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="linear-models.html#cb289-1" aria-hidden="true" tabindex="-1"></a>qual.lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(quality <span class="sc">~</span> catchment, <span class="at">data =</span> waterQual)</span>
<span id="cb289-2"><a href="linear-models.html#cb289-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-3"><a href="linear-models.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(qual.lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = quality ~ catchment, data = waterQual)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -29.078 -14.218  -1.309  17.742  23.240 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  49.7945     8.5246   5.841 1.56e-05 ***
## catchment     0.4602     0.2966   1.552    0.138    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 18.81 on 18 degrees of freedom
## Multiple R-squared:  0.118,  Adjusted R-squared:  0.06898 
## F-statistic: 2.408 on 1 and 18 DF,  p-value: 0.1381</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="linear-models.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(waterQual<span class="sc">$</span>quality <span class="sc">~</span> waterQual<span class="sc">$</span>catchment, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>), </span>
<span id="cb291-2"><a href="linear-models.html#cb291-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">105</span>), <span class="at">frame =</span> T)</span>
<span id="cb291-3"><a href="linear-models.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span><span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb291-4"><a href="linear-models.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb291-5"><a href="linear-models.html#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(qual.lm1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-148-1.png" width="672" /></p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="linear-models.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Get values for plotting 95 % confidence band</span></span>
<span id="cb292-2"><a href="linear-models.html#cb292-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-3"><a href="linear-models.html#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Make set of X values at which to predict response</span></span>
<span id="cb292-4"><a href="linear-models.html#cb292-4" aria-hidden="true" tabindex="-1"></a>Xdata <span class="ot">&lt;-</span> <span class="fu">with</span>(waterQual, <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(catchment), <span class="at">to =</span> <span class="fu">max</span>(catchment), </span>
<span id="cb292-5"><a href="linear-models.html#cb292-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">length =</span> <span class="dv">50</span>))</span>
<span id="cb292-6"><a href="linear-models.html#cb292-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-7"><a href="linear-models.html#cb292-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  Put those new X values into a data frame with column name same as X </span></span>
<span id="cb292-8"><a href="linear-models.html#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    variable in fitted model</span></span>
<span id="cb292-9"><a href="linear-models.html#cb292-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-10"><a href="linear-models.html#cb292-10" aria-hidden="true" tabindex="-1"></a>Xnew <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">catchment =</span> Xdata)</span>
<span id="cb292-11"><a href="linear-models.html#cb292-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-12"><a href="linear-models.html#cb292-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-13"><a href="linear-models.html#cb292-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  Use these X values to get predictions for Y from model</span></span>
<span id="cb292-14"><a href="linear-models.html#cb292-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-15"><a href="linear-models.html#cb292-15" aria-hidden="true" tabindex="-1"></a>ypred <span class="ot">&lt;-</span> <span class="fu">predict</span>(qual.lm1, <span class="at">newdata =</span> Xnew, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>, </span>
<span id="cb292-16"><a href="linear-models.html#cb292-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="linear-models.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ypred)</span></code></pre></div>
<pre><code>##  num [1:50, 1:3] 52.1 52.6 53.1 53.6 54 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:50] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   ..$ : chr [1:3] &quot;fit&quot; &quot;lwr&quot; &quot;upr&quot;</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="linear-models.html#cb295-1" aria-hidden="true" tabindex="-1"></a>ypred[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span></code></pre></div>
<pre><code>##         fit      lwr      upr
## 1  52.09562 36.81859 67.37266
## 2  52.58402 37.84145 67.32659
## 3  53.07241 38.85364 67.29119
## 4  53.56081 39.85394 67.26768
## 5  54.04921 40.84096 67.25745
## 6  54.53760 41.81316 67.26205
## 7  55.02600 42.76876 67.28323
## 8  55.51439 43.70580 67.32298
## 9  56.00279 44.62209 67.38348
## 10 56.49118 45.51520 67.46716</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="linear-models.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  For convenience, put Y alues for confidence band in a data frame</span></span>
<span id="cb297-2"><a href="linear-models.html#cb297-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-3"><a href="linear-models.html#cb297-3" aria-hidden="true" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lower =</span> ypred[ , <span class="st">&quot;lwr&quot;</span>], <span class="at">upper =</span> ypred[ , <span class="st">&quot;upr&quot;</span>])</span>
<span id="cb297-4"><a href="linear-models.html#cb297-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-5"><a href="linear-models.html#cb297-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  Put the plot together</span></span>
<span id="cb297-6"><a href="linear-models.html#cb297-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-7"><a href="linear-models.html#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex.axis =</span> <span class="fl">0.9</span>)</span>
<span id="cb297-8"><a href="linear-models.html#cb297-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(waterQual<span class="sc">$</span>quality <span class="sc">~</span> waterQual<span class="sc">$</span>catchment, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>), </span>
<span id="cb297-9"><a href="linear-models.html#cb297-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">105</span>), <span class="at">frame =</span> T)</span>
<span id="cb297-10"><a href="linear-models.html#cb297-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span><span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb297-11"><a href="linear-models.html#cb297-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb297-12"><a href="linear-models.html#cb297-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(Xnew<span class="sc">$</span>catchment, ypred[ , <span class="st">&quot;fit&quot;</span>])</span>
<span id="cb297-13"><a href="linear-models.html#cb297-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(Xnew<span class="sc">$</span>catchment, ci<span class="sc">$</span>lower, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>)</span>
<span id="cb297-14"><a href="linear-models.html#cb297-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(Xnew<span class="sc">$</span>catchment, ci<span class="sc">$</span>upper, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidyverse.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-mixed-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": null
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
