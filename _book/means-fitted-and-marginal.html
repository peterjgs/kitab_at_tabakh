<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Means - fitted and marginal | Kitab at-Tabakh</title>
  <meta name="description" content="This is a collection of miscellaneous statistics-related recipes and notes." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Means - fitted and marginal | Kitab at-Tabakh" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a collection of miscellaneous statistics-related recipes and notes." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Means - fitted and marginal | Kitab at-Tabakh" />
  
  <meta name="twitter:description" content="This is a collection of miscellaneous statistics-related recipes and notes." />
  

<meta name="author" content="Peter Geelan-Small" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="count-data.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="1" data-path="mawaqif.html"><a href="mawaqif.html"><i class="fa fa-check"></i><b>1</b> Mawaqif</a>
<ul>
<li class="chapter" data-level="1.1" data-path="mawaqif.html"><a href="mawaqif.html#confounders"><i class="fa fa-check"></i><b>1.1</b> Confounders</a></li>
<li class="chapter" data-level="1.2" data-path="mawaqif.html"><a href="mawaqif.html#exponential-models"><i class="fa fa-check"></i><b>1.2</b> Exponential models</a></li>
<li class="chapter" data-level="1.3" data-path="mawaqif.html"><a href="mawaqif.html#power-function"><i class="fa fa-check"></i><b>1.3</b> Power function</a></li>
<li class="chapter" data-level="1.4" data-path="mawaqif.html"><a href="mawaqif.html#roc-curves"><i class="fa fa-check"></i><b>1.4</b> ROC curves</a></li>
<li class="chapter" data-level="1.5" data-path="mawaqif.html"><a href="mawaqif.html#variable-selection"><i class="fa fa-check"></i><b>1.5</b> Variable selection</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="mawaqif.html"><a href="mawaqif.html#davison-2003-statistical-models"><i class="fa fa-check"></i><b>1.5.1</b> Davison 2003, Statistical Models</a></li>
<li class="chapter" data-level="1.5.2" data-path="mawaqif.html"><a href="mawaqif.html#faraway-2014-linear-models-with-r"><i class="fa fa-check"></i><b>1.5.2</b> Faraway 2014, Linear Models with R</a></li>
<li class="chapter" data-level="1.5.3" data-path="mawaqif.html"><a href="mawaqif.html#faraway-2016-extending-the-linear-model-with-r-2nd-ed."><i class="fa fa-check"></i><b>1.5.3</b> Faraway 2016, Extending the Linear Model with R, 2nd ed.</a></li>
<li class="chapter" data-level="1.5.4" data-path="mawaqif.html"><a href="mawaqif.html#weisberg-2014-applied-linear-regression-4th-ed."><i class="fa fa-check"></i><b>1.5.4</b> Weisberg 2014, Applied Linear Regression, 4th ed.</a></li>
<li class="chapter" data-level="1.5.5" data-path="mawaqif.html"><a href="mawaqif.html#harrell-2015-regression-modeling-strategies-2nd-ed."><i class="fa fa-check"></i><b>1.5.5</b> Harrell 2015, Regression Modeling Strategies, 2nd ed.</a></li>
<li class="chapter" data-level="1.5.6" data-path="mawaqif.html"><a href="mawaqif.html#david-wartons-draft-book-chapter-5"><i class="fa fa-check"></i><b>1.5.6</b> David Warton’s draft book, chapter 5</a></li>
<li class="chapter" data-level="1.5.7" data-path="mawaqif.html"><a href="mawaqif.html#james-et-al.-introduction-to-statistical-learning-2017-corrected-printing"><i class="fa fa-check"></i><b>1.5.7</b> James et al. Introduction to Statistical Learning, 2017 (corrected printing)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>2</b> ggplot</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ggplot.html"><a href="ggplot.html#vignettes"><i class="fa fa-check"></i><b>2.1</b> Vignettes</a></li>
<li class="chapter" data-level="2.2" data-path="ggplot.html"><a href="ggplot.html#confidence-bands"><i class="fa fa-check"></i><b>2.2</b> Confidence bands</a></li>
<li class="chapter" data-level="2.3" data-path="ggplot.html"><a href="ggplot.html#confidence-bands-fitted-models"><i class="fa fa-check"></i><b>2.3</b> Confidence bands: fitted models</a></li>
<li class="chapter" data-level="2.4" data-path="ggplot.html"><a href="ggplot.html#histogram"><i class="fa fa-check"></i><b>2.4</b> Histogram</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="ggplot.html"><a href="ggplot.html#histogram-one-vector-of-values"><i class="fa fa-check"></i><b>2.4.1</b> Histogram: one vector of values</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="ggplot.html"><a href="ggplot.html#density-plot"><i class="fa fa-check"></i><b>2.5</b> Density plot</a></li>
<li class="chapter" data-level="2.6" data-path="ggplot.html"><a href="ggplot.html#plot-structure"><i class="fa fa-check"></i><b>2.6</b> Plot structure</a></li>
<li class="chapter" data-level="2.7" data-path="ggplot.html"><a href="ggplot.html#label-legend"><i class="fa fa-check"></i><b>2.7</b> Label legend</a></li>
<li class="chapter" data-level="2.8" data-path="ggplot.html"><a href="ggplot.html#plot-title"><i class="fa fa-check"></i><b>2.8</b> Plot title</a></li>
<li class="chapter" data-level="2.9" data-path="ggplot.html"><a href="ggplot.html#three-category-colours"><i class="fa fa-check"></i><b>2.9</b> Three-category colours</a></li>
<li class="chapter" data-level="2.10" data-path="ggplot.html"><a href="ggplot.html#set-breaks-for-scale"><i class="fa fa-check"></i><b>2.10</b> Set breaks for scale</a></li>
<li class="chapter" data-level="2.11" data-path="ggplot.html"><a href="ggplot.html#display-table-to-2-d.p."><i class="fa fa-check"></i><b>2.11</b> Display table to 2 d.p.</a></li>
<li class="chapter" data-level="2.12" data-path="ggplot.html"><a href="ggplot.html#redefine-factor-levels-for-an-individual-plot"><i class="fa fa-check"></i><b>2.12</b> Redefine factor levels for an individual plot</a></li>
<li class="chapter" data-level="2.13" data-path="ggplot.html"><a href="ggplot.html#plotting-two-data-sets-of-different-length-on-one-plot"><i class="fa fa-check"></i><b>2.13</b> Plotting two data sets of different length on one plot</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>3</b> R Markdown</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-markdown.html"><a href="r-markdown.html#ioslides-footnotes"><i class="fa fa-check"></i><b>3.1</b> ioslides: Footnotes</a></li>
<li class="chapter" data-level="3.2" data-path="r-markdown.html"><a href="r-markdown.html#ioslides-speakers-notes"><i class="fa fa-check"></i><b>3.2</b> ioslides: Speaker’s notes</a></li>
<li class="chapter" data-level="3.3" data-path="r-markdown.html"><a href="r-markdown.html#how-to-make-multi-line-tables"><i class="fa fa-check"></i><b>3.3</b> How to make multi-line tables</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>4</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidyverse.html"><a href="tidyverse.html#stacking-and-unstacking-data"><i class="fa fa-check"></i><b>4.1</b> Stacking and unstacking data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>5</b> Linear Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-models.html"><a href="linear-models.html#anova-orthogonal-factors"><i class="fa fa-check"></i><b>5.1</b> ANOVA: Orthogonal factors</a></li>
<li class="chapter" data-level="5.2" data-path="linear-models.html"><a href="linear-models.html#multiple-linear-regression---conditional-and-marginal-effects"><i class="fa fa-check"></i><b>5.2</b> Multiple linear regression - conditional and marginal effects</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="linear-models.html"><a href="linear-models.html#marginal-and-conditional-interpretations"><i class="fa fa-check"></i><b>5.2.1</b> Marginal and Conditional interpretations</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="linear-models.html"><a href="linear-models.html#linear-model-with-subsampling"><i class="fa fa-check"></i><b>5.3</b> Linear model with subsampling</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="linear-models.html"><a href="linear-models.html#load-necessary-r-packages"><i class="fa fa-check"></i><b>5.3.1</b> Load necessary R packages</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#example"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="5.3.2" data-path="linear-models.html"><a href="linear-models.html#data"><i class="fa fa-check"></i><b>5.3.2</b> Data</a></li>
<li class="chapter" data-level="5.3.3" data-path="linear-models.html"><a href="linear-models.html#summary-statistics-and-plots"><i class="fa fa-check"></i><b>5.3.3</b> Summary statistics and plots</a></li>
<li class="chapter" data-level="5.3.4" data-path="linear-models.html"><a href="linear-models.html#wrong-analysis-fixed-effects-linear-model"><i class="fa fa-check"></i><b>5.3.4</b> Wrong analysis: fixed effects linear model</a></li>
<li class="chapter" data-level="5.3.5" data-path="linear-models.html"><a href="linear-models.html#right-analysis-mixed-effects-linear-model"><i class="fa fa-check"></i><b>5.3.5</b> Right analysis: mixed effects linear model</a></li>
<li class="chapter" data-level="5.3.6" data-path="linear-models.html"><a href="linear-models.html#an-aside---checking-model-assumptions"><i class="fa fa-check"></i><b>5.3.6</b> An aside - checking model assumptions</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#equal-variance-assumption"><i class="fa fa-check"></i>Equal variance assumption</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#normal-distribution-assumption"><i class="fa fa-check"></i>Normal distribution assumption</a></li>
<li class="chapter" data-level="5.3.7" data-path="linear-models.html"><a href="linear-models.html#fitted-values-and-confidence-intervals"><i class="fa fa-check"></i><b>5.3.7</b> Fitted values and confidence intervals</a></li>
<li class="chapter" data-level="5.3.8" data-path="linear-models.html"><a href="linear-models.html#another-aside---code-the-nested-structure---not-recommended"><i class="fa fa-check"></i><b>5.3.8</b> Another aside - code the nested structure - not recommended</a></li>
<li class="chapter" data-level="5.3.9" data-path="linear-models.html"><a href="linear-models.html#summary"><i class="fa fa-check"></i><b>5.3.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="linear-models.html"><a href="linear-models.html#marginal-means---emmeans-example"><i class="fa fa-check"></i><b>5.4</b> Marginal means - emmeans example</a></li>
<li class="chapter" data-level="5.5" data-path="linear-models.html"><a href="linear-models.html#multiple-regression-example"><i class="fa fa-check"></i><b>5.5</b> Multiple regression example</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="linear-models.html"><a href="linear-models.html#regression-model"><i class="fa fa-check"></i><b>5.5.1</b> Regression model</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="linear-models.html"><a href="linear-models.html#residual-plots---redres"><i class="fa fa-check"></i><b>5.6</b> Residual plots - redres</a></li>
<li class="chapter" data-level="5.7" data-path="linear-models.html"><a href="linear-models.html#interactions---examples"><i class="fa fa-check"></i><b>5.7</b> Interactions - examples</a></li>
<li class="chapter" data-level="5.8" data-path="linear-models.html"><a href="linear-models.html#interaction-plot-in-ggplot2"><i class="fa fa-check"></i><b>5.8</b> Interaction plot in ggplot2</a></li>
<li class="chapter" data-level="5.9" data-path="linear-models.html"><a href="linear-models.html#plot-simple-linear-regression-fitted-line-with-95-confidence-band"><i class="fa fa-check"></i><b>5.9</b> Plot simple linear regression fitted line with 95 % confidence band</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html"><i class="fa fa-check"></i><b>6</b> Linear mixed models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html#finding-variance-components-from-lme-models"><i class="fa fa-check"></i><b>6.1</b> Finding variance components from lme models</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="experimental-design.html"><a href="experimental-design.html"><i class="fa fa-check"></i><b>7</b> Experimental design</a>
<ul>
<li class="chapter" data-level="7.1" data-path="experimental-design.html"><a href="experimental-design.html#sample-size-by-simulation"><i class="fa fa-check"></i><b>7.1</b> Sample size by simulation</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="count-data.html"><a href="count-data.html"><i class="fa fa-check"></i><b>8</b> Count data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="count-data.html"><a href="count-data.html#count-data-tests-of-independence-and-homogeneity"><i class="fa fa-check"></i><b>8.1</b> Count data: tests of independence and homogeneity</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="count-data.html"><a href="count-data.html#independence"><i class="fa fa-check"></i><b>8.1.1</b> Independence</a></li>
<li class="chapter" data-level="8.1.2" data-path="count-data.html"><a href="count-data.html#homogeneity"><i class="fa fa-check"></i><b>8.1.2</b> Homogeneity</a></li>
<li class="chapter" data-level="8.1.3" data-path="count-data.html"><a href="count-data.html#comparing-two-proportions"><i class="fa fa-check"></i><b>8.1.3</b> Comparing two proportions</a></li>
<li class="chapter" data-level="8.1.4" data-path="count-data.html"><a href="count-data.html#small-counts"><i class="fa fa-check"></i><b>8.1.4</b> Small Counts</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="count-data.html"><a href="count-data.html#contingency-tables---fixed-row-and-columns-totals"><i class="fa fa-check"></i><b>8.2</b> Contingency tables - fixed row and columns totals</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html"><i class="fa fa-check"></i><b>9</b> Means - fitted and marginal</a>
<ul>
<li class="chapter" data-level="9.1" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#load-necessary-packages"><i class="fa fa-check"></i><b>9.1</b> Load necessary packages</a></li>
<li class="chapter" data-level="9.2" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#data---genotype-from-mass-package"><i class="fa fa-check"></i><b>9.2</b> Data - “genotype” from MASS package</a></li>
<li class="chapter" data-level="9.3" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#model"><i class="fa fa-check"></i><b>9.3</b> Model</a></li>
<li class="chapter" data-level="9.4" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#fitted-values-using-predict"><i class="fa fa-check"></i><b>9.4</b> Fitted values using “predict”</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#fitted-values-with-interval-confidence"><i class="fa fa-check"></i><b>9.4.1</b> Fitted values (with interval = “confidence”)</a></li>
<li class="chapter" data-level="9.4.2" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#fitted-values-with-interval-prediction"><i class="fa fa-check"></i><b>9.4.2</b> Fitted values (with interval = “prediction”)</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#manually-fitting-model-using-matrix-algebra"><i class="fa fa-check"></i><b>9.5</b> Manually fitting model using matrix algebra</a></li>
<li class="chapter" data-level="9.6" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#estimated-means-using-model-coefficients-and-various-weights"><i class="fa fa-check"></i><b>9.6</b> Estimated means using model coefficients and various weights</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#marginal-means-for-litter"><i class="fa fa-check"></i><b>9.6.1</b> Marginal means for Litter</a></li>
<li class="chapter" data-level="9.6.2" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#marginal-means-for-mother"><i class="fa fa-check"></i><b>9.6.2</b> Marginal means for Mother</a></li>
<li class="chapter" data-level="9.6.3" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#using-a-matrix-with-equal-weights"><i class="fa fa-check"></i><b>9.6.3</b> Using a matrix with equal weights</a></li>
<li class="chapter" data-level="9.6.4" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#using-a-matrix-with-proportional-weights"><i class="fa fa-check"></i><b>9.6.4</b> Using a matrix with proportional weights</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#estimates-using-effects-package"><i class="fa fa-check"></i><b>9.7</b> Estimates using “effects” package</a></li>
<li class="chapter" data-level="9.8" data-path="means-fitted-and-marginal.html"><a href="means-fitted-and-marginal.html#transformations-and-emmeans"><i class="fa fa-check"></i><b>9.8</b> Transformations and <code>emmeans</code></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Kitab at-Tabakh</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="means---fitted-and-marginal" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Means - fitted and marginal</h1>
<div id="load-necessary-packages" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Load necessary packages</h2>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="means-fitted-and-marginal.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb319-2"><a href="means-fitted-and-marginal.html#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb319-3"><a href="means-fitted-and-marginal.html#cb319-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb319-4"><a href="means-fitted-and-marginal.html#cb319-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb319-5"><a href="means-fitted-and-marginal.html#cb319-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb319-6"><a href="means-fitted-and-marginal.html#cb319-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb319-7"><a href="means-fitted-and-marginal.html#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DAAG)</span>
<span id="cb319-8"><a href="means-fitted-and-marginal.html#cb319-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
<p><br></p>
</div>
<div id="data---genotype-from-mass-package" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Data - “genotype” from MASS package</h2>
<p>Use “genotype” data from MASS package as an example (data obtained from Scheffé (1959)).</p>
<p>Brief details about the data follow.</p>
<p>Data from a foster feeding experiment with rat mothers and litters of four different genotypes: A, B, I and J. Rat litters were separated from their natural mothers at birth and given to foster mothers to rear.</p>
<p>The data frame has the following components:</p>
<p><em>Litter</em> genotype of the litter.</p>
<p><em>Mother</em> genotype of the foster mother.</p>
<p><em>Wt</em> litter average weight gain of the litter, in grams at age 28 days (the source states that the within-litter variability is negligible).</p>
<p><br></p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="means-fitted-and-marginal.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(genotype, <span class="at">package =</span> <span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb320-2"><a href="means-fitted-and-marginal.html#cb320-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-3"><a href="means-fitted-and-marginal.html#cb320-3" aria-hidden="true" tabindex="-1"></a>gtype <span class="ot">&lt;-</span> genotype</span>
<span id="cb320-4"><a href="means-fitted-and-marginal.html#cb320-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-5"><a href="means-fitted-and-marginal.html#cb320-5" aria-hidden="true" tabindex="-1"></a>freq.cell <span class="ot">&lt;-</span> </span>
<span id="cb320-6"><a href="means-fitted-and-marginal.html#cb320-6" aria-hidden="true" tabindex="-1"></a>  gtype <span class="sc">%&gt;%</span> </span>
<span id="cb320-7"><a href="means-fitted-and-marginal.html#cb320-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Mother, Litter)</span>
<span id="cb320-8"><a href="means-fitted-and-marginal.html#cb320-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-9"><a href="means-fitted-and-marginal.html#cb320-9" aria-hidden="true" tabindex="-1"></a>freq.cell</span></code></pre></div>
<pre><code>##    Mother Litter n
## 1       A      A 5
## 2       A      B 4
## 3       A      I 3
## 4       A      J 4
## 5       B      A 3
## 6       B      B 5
## 7       B      I 3
## 8       B      J 3
## 9       I      A 4
## 10      I      B 4
## 11      I      I 5
## 12      I      J 3
## 13      J      A 5
## 14      J      B 2
## 15      J      I 3
## 16      J      J 5</code></pre>
<p>Table of cell frequencies</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="means-fitted-and-marginal.html#cb322-1" aria-hidden="true" tabindex="-1"></a>freq.cell.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(freq.cell<span class="sc">$</span>n, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb322-2"><a href="means-fitted-and-marginal.html#cb322-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-3"><a href="means-fitted-and-marginal.html#cb322-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(freq.cell.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Litter_A&quot;</span>, <span class="st">&quot;Litter_B&quot;</span>, <span class="st">&quot;Litter_I&quot;</span>, <span class="st">&quot;Litter_J&quot;</span>)</span>
<span id="cb322-4"><a href="means-fitted-and-marginal.html#cb322-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(freq.cell.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mother_A&quot;</span>, <span class="st">&quot;Mother_B&quot;</span>, <span class="st">&quot;Mother_I&quot;</span>, <span class="st">&quot;Mother_J&quot;</span>)</span>
<span id="cb322-5"><a href="means-fitted-and-marginal.html#cb322-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-6"><a href="means-fitted-and-marginal.html#cb322-6" aria-hidden="true" tabindex="-1"></a>freq.cell <span class="ot">&lt;-</span> freq.cell.mat</span>
<span id="cb322-7"><a href="means-fitted-and-marginal.html#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(freq.cell.mat)</span>
<span id="cb322-8"><a href="means-fitted-and-marginal.html#cb322-8" aria-hidden="true" tabindex="-1"></a>freq.cell</span></code></pre></div>
<pre><code>##          Mother_A Mother_B Mother_I Mother_J
## Litter_A        5        3        4        5
## Litter_B        4        5        4        2
## Litter_I        3        3        5        3
## Litter_J        4        3        3        5</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="means-fitted-and-marginal.html#cb324-1" aria-hidden="true" tabindex="-1"></a>gtype <span class="sc">%&gt;%</span></span>
<span id="cb324-2"><a href="means-fitted-and-marginal.html#cb324-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Litter)</span></code></pre></div>
<pre><code>##   Litter  n
## 1      A 17
## 2      B 15
## 3      I 14
## 4      J 15</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="means-fitted-and-marginal.html#cb326-1" aria-hidden="true" tabindex="-1"></a>gtype <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="means-fitted-and-marginal.html#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Mother)</span></code></pre></div>
<pre><code>##   Mother  n
## 1      A 16
## 2      B 14
## 3      I 16
## 4      J 15</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="means-fitted-and-marginal.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gtype, <span class="fu">aes</span>(<span class="at">x =</span> Mother, <span class="at">y =</span> Wt, <span class="at">colour =</span> Litter)) <span class="sc">+</span></span>
<span id="cb328-2"><a href="means-fitted-and-marginal.html#cb328-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-172-1.png" width="672" /></p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="means-fitted-and-marginal.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gtype, <span class="fu">aes</span>(<span class="at">x =</span> Litter, <span class="at">y =</span> Wt, <span class="at">colour =</span> Mother)) <span class="sc">+</span></span>
<span id="cb329-2"><a href="means-fitted-and-marginal.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-173-1.png" width="672" /></p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="means-fitted-and-marginal.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gtype, <span class="fu">aes</span>(<span class="at">x =</span> Litter, <span class="at">y =</span> Wt, </span>
<span id="cb330-2"><a href="means-fitted-and-marginal.html#cb330-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">colour =</span> Litter)) <span class="sc">+</span> </span>
<span id="cb330-3"><a href="means-fitted-and-marginal.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb330-4"><a href="means-fitted-and-marginal.html#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Mother, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb330-5"><a href="means-fitted-and-marginal.html#cb330-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-174-1.png" width="672" /></p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="means-fitted-and-marginal.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gtype)</span></code></pre></div>
<pre><code>##  Litter Mother       Wt       
##  A:17   A:16   Min.   :36.30  
##  B:15   B:14   1st Qu.:48.20  
##  I:14   I:16   Median :54.00  
##  J:15   J:15   Mean   :53.97  
##                3rd Qu.:60.30  
##                Max.   :69.80</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="means-fitted-and-marginal.html#cb333-1" aria-hidden="true" tabindex="-1"></a>gtype <span class="sc">%&gt;%</span></span>
<span id="cb333-2"><a href="means-fitted-and-marginal.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Litter) <span class="sc">%&gt;%</span></span>
<span id="cb333-3"><a href="means-fitted-and-marginal.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_litter =</span> <span class="fu">mean</span>(Wt), </span>
<span id="cb333-4"><a href="means-fitted-and-marginal.html#cb333-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">std.dev_litter =</span> <span class="fu">sd</span>(Wt))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   Litter mean_litter std.dev_litter
##   &lt;fct&gt;        &lt;dbl&gt;          &lt;dbl&gt;
## 1 A             55.1           8.63
## 2 B             54.7           7.13
## 3 I             52.9          11.3 
## 4 J             53.0           5.87</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="means-fitted-and-marginal.html#cb335-1" aria-hidden="true" tabindex="-1"></a>gtype <span class="sc">%&gt;%</span></span>
<span id="cb335-2"><a href="means-fitted-and-marginal.html#cb335-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Mother) <span class="sc">%&gt;%</span></span>
<span id="cb335-3"><a href="means-fitted-and-marginal.html#cb335-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_mother =</span> <span class="fu">mean</span>(Wt), </span>
<span id="cb335-4"><a href="means-fitted-and-marginal.html#cb335-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">std.dev_mother =</span> <span class="fu">sd</span>(Wt))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   Mother mean_mother std.dev_mother
##   &lt;fct&gt;        &lt;dbl&gt;          &lt;dbl&gt;
## 1 A             55.4           9.89
## 2 B             58.7           7.24
## 3 I             53.4           6.45
## 4 J             48.7           6.30</code></pre>
<p><br></p>
</div>
<div id="model" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Model</h2>
<p>Explain animal weight by Litter and Mother.</p>
<p>Order: <em>Litter + Mother</em></p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="means-fitted-and-marginal.html#cb337-1" aria-hidden="true" tabindex="-1"></a>gtype.lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Wt <span class="sc">~</span> Litter <span class="sc">+</span> Mother, <span class="at">data =</span> gtype)</span>
<span id="cb337-2"><a href="means-fitted-and-marginal.html#cb337-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3"><a href="means-fitted-and-marginal.html#cb337-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gtype.lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Wt ~ Litter + Mother, data = gtype)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -18.425  -5.584   2.499   5.416  13.745 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   56.909      2.478  22.964   &lt;2e-16 ***
## LitterB       -2.025      2.795  -0.725   0.4719    
## LitterI       -2.654      2.827  -0.939   0.3520    
## LitterJ       -2.021      2.757  -0.733   0.4668    
## MotherB        3.516      2.862   1.229   0.2246    
## MotherI       -1.832      2.767  -0.662   0.5107    
## MotherJ       -6.755      2.810  -2.404   0.0197 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.776 on 54 degrees of freedom
## Multiple R-squared:  0.2037, Adjusted R-squared:  0.1152 
## F-statistic: 2.302 on 6 and 54 DF,  p-value: 0.04732</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="means-fitted-and-marginal.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gtype.lm1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Wt
##           Df Sum Sq Mean Sq F value   Pr(&gt;F)   
## Litter     3   60.2  20.052  0.3317 0.802470   
## Mother     3  775.1 258.360  4.2732 0.008861 **
## Residuals 54 3264.9  60.461                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br></p>
<p>Order: <em>Mother + Litter</em></p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="means-fitted-and-marginal.html#cb341-1" aria-hidden="true" tabindex="-1"></a>gtype.lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Wt <span class="sc">~</span> Mother <span class="sc">+</span> Litter, <span class="at">data =</span> gtype)</span>
<span id="cb341-2"><a href="means-fitted-and-marginal.html#cb341-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-3"><a href="means-fitted-and-marginal.html#cb341-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gtype.lm2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Wt ~ Mother + Litter, data = gtype)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -18.425  -5.584   2.499   5.416  13.745 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   56.909      2.478  22.964   &lt;2e-16 ***
## MotherB        3.516      2.862   1.229   0.2246    
## MotherI       -1.832      2.767  -0.662   0.5107    
## MotherJ       -6.755      2.810  -2.404   0.0197 *  
## LitterB       -2.025      2.795  -0.725   0.4719    
## LitterI       -2.654      2.827  -0.939   0.3520    
## LitterJ       -2.021      2.757  -0.733   0.4668    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.776 on 54 degrees of freedom
## Multiple R-squared:  0.2037, Adjusted R-squared:  0.1152 
## F-statistic: 2.302 on 6 and 54 DF,  p-value: 0.04732</code></pre>
<p>Note model coefficients are the same regardless of order of explanatory terms.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="means-fitted-and-marginal.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gtype.lm2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Wt
##           Df Sum Sq Mean Sq F value   Pr(&gt;F)   
## Mother     3  771.6 257.202  4.2540 0.009055 **
## Litter     3   63.6  21.211  0.3508 0.788698   
## Residuals 54 3264.9  60.461                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><br></p>
</div>
<div id="fitted-values-using-predict" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Fitted values using “predict”</h2>
<p>Make a prediction grid.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="means-fitted-and-marginal.html#cb345-1" aria-hidden="true" tabindex="-1"></a>pred.comb <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">Litter =</span> <span class="fu">levels</span>(gtype<span class="sc">$</span>Litter), </span>
<span id="cb345-2"><a href="means-fitted-and-marginal.html#cb345-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Mother =</span> <span class="fu">levels</span>(gtype<span class="sc">$</span>Mother))</span>
<span id="cb345-3"><a href="means-fitted-and-marginal.html#cb345-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-4"><a href="means-fitted-and-marginal.html#cb345-4" aria-hidden="true" tabindex="-1"></a>pred.comb</span></code></pre></div>
<pre><code>##    Litter Mother
## 1       A      A
## 2       B      A
## 3       I      A
## 4       J      A
## 5       A      B
## 6       B      B
## 7       I      B
## 8       J      B
## 9       A      I
## 10      B      I
## 11      I      I
## 12      J      I
## 13      A      J
## 14      B      J
## 15      I      J
## 16      J      J</code></pre>
<p><br></p>
<div id="fitted-values-with-interval-confidence" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Fitted values (with interval = “confidence”)</h3>
<p>This gives a 95% confidence interval for predicted mean.</p>
<p>For example, for Litter A with Mother A:</p>
<p>Note <span class="math inline">\(t_{0.975, 54} = 2.004879\)</span>.</p>
<p><span class="math inline">\(56.90907 \pm 2.004879 \times 2.478191 = (51.9406, 61.8775)\)</span></p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="means-fitted-and-marginal.html#cb347-1" aria-hidden="true" tabindex="-1"></a>ypred.lm1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pred.comb, <span class="fu">predict</span>(gtype.lm1, <span class="at">newdata =</span> pred.comb, </span>
<span id="cb347-2"><a href="means-fitted-and-marginal.html#cb347-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">se.fit =</span> T,</span>
<span id="cb347-3"><a href="means-fitted-and-marginal.html#cb347-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>))</span>
<span id="cb347-4"><a href="means-fitted-and-marginal.html#cb347-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-5"><a href="means-fitted-and-marginal.html#cb347-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ypred.lm1)[<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;lwr&quot;</span>, <span class="st">&quot;upr&quot;</span>)</span>
<span id="cb347-6"><a href="means-fitted-and-marginal.html#cb347-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-7"><a href="means-fitted-and-marginal.html#cb347-7" aria-hidden="true" tabindex="-1"></a>ypred.lm1</span></code></pre></div>
<pre><code>##    Litter Mother      fit      lwr      upr   se.fit df
## 1       A      A 56.90907 51.94060 61.87755 2.478191 54
## 2       B      A 54.88389 49.61652 60.15126 2.627276 54
## 3       I      A 54.25550 48.75199 59.75900 2.745055 54
## 4       J      A 54.88814 49.64332 60.13297 2.616031 54
## 5       A      B 60.42496 54.94929 65.90063 2.731171 54
## 6       B      B 58.39978 53.24788 63.55167 2.569678 54
## 7       I      B 57.77138 52.13866 63.40411 2.809507 54
## 8       J      B 58.40403 52.82074 63.98732 2.784850 54
## 9       A      I 55.07696 49.91311 60.24082 2.575644 54
## 10      B      I 53.05178 47.77668 58.32688 2.631131 54
## 11      I      I 52.42339 47.32272 57.52405 2.544125 54
## 12      J      I 53.05603 47.60151 58.51056 2.720625 54
## 13      A      J 50.15438 45.11565 55.19311 2.513234 54
## 14      B      J 48.12920 42.38172 53.87668 2.866746 54
## 15      I      J 47.50081 41.91048 53.09114 2.788361 54
## 16      J      J 48.13345 43.02595 53.24095 2.547534 54
##    residual.scale
## 1        7.775661
## 2        7.775661
## 3        7.775661
## 4        7.775661
## 5        7.775661
## 6        7.775661
## 7        7.775661
## 8        7.775661
## 9        7.775661
## 10       7.775661
## 11       7.775661
## 12       7.775661
## 13       7.775661
## 14       7.775661
## 15       7.775661
## 16       7.775661</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="means-fitted-and-marginal.html#cb349-1" aria-hidden="true" tabindex="-1"></a>ypred.lm1.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(ypred.lm1<span class="sc">$</span>fit, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb349-2"><a href="means-fitted-and-marginal.html#cb349-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-3"><a href="means-fitted-and-marginal.html#cb349-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ypred.lm1.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Litter_A&quot;</span>, <span class="st">&quot;Litter_B&quot;</span>, <span class="st">&quot;Litter_I&quot;</span>, <span class="st">&quot;Litter_J&quot;</span>)</span>
<span id="cb349-4"><a href="means-fitted-and-marginal.html#cb349-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ypred.lm1.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mother_A&quot;</span>, <span class="st">&quot;Mother_B&quot;</span>, <span class="st">&quot;Mother_I&quot;</span>, <span class="st">&quot;Mother_J&quot;</span>)</span>
<span id="cb349-5"><a href="means-fitted-and-marginal.html#cb349-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-6"><a href="means-fitted-and-marginal.html#cb349-6" aria-hidden="true" tabindex="-1"></a>ypred.lm1.mat</span></code></pre></div>
<pre><code>##          Mother_A Mother_B Mother_I Mother_J
## Litter_A 56.90907 60.42496 55.07696 50.15438
## Litter_B 54.88389 58.39978 53.05178 48.12920
## Litter_I 54.25550 57.77138 52.42339 47.50081
## Litter_J 54.88814 58.40403 53.05603 48.13345</code></pre>
<p><br></p>
</div>
<div id="fitted-values-with-interval-prediction" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Fitted values (with interval = “prediction”)</h3>
<p>This gives a 95% confidence interval for a single future observed value.</p>
<p>The SE for a single future observation is (must be!) larger than that for the predicted mean. The SE for a given observed value is
<span class="math inline">\(\sqrt{[\mathrm{var(predicted \; mean)} + \widehat{\sigma^2}]}\)</span>
(see Searle, <em>Linear Models</em>, p. 91).</p>
<p>For example, for Litter A with Mother A:</p>
<p>Note <span class="math inline">\(t_{0.975, 54} = 2.004879\)</span>.</p>
<p><span class="math inline">\(\mathrm{se} = \sqrt{2.478191^2 + 7.775661^2} = 8.161025\)</span></p>
<p><span class="math inline">\(56.90907 \pm 2.004879 \times 8.161025 = (40.5472, 73.2709)\)</span></p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="means-fitted-and-marginal.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(gtype.lm1, <span class="at">newdata =</span> pred.comb, <span class="at">se.fit =</span> T,</span>
<span id="cb351-2"><a href="means-fitted-and-marginal.html#cb351-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span></code></pre></div>
<pre><code>## $fit
##         fit      lwr      upr
## 1  56.90907 40.54720 73.27094
## 2  54.88389 38.42879 71.33899
## 3  54.25550 37.72330 70.78770
## 4  54.88814 38.44025 71.33604
## 5  60.42496 43.90200 76.94791
## 6  58.39978 41.98128 74.81828
## 7  57.77138 41.19572 74.34705
## 8  58.40403 41.84510 74.96296
## 9  55.07696 38.65471 71.49922
## 10 53.05178 36.59421 69.50936
## 11 52.42339 36.02089 68.82588
## 12 53.05603 36.54007 69.57199
## 13 50.15438 33.77104 66.53773
## 14 48.12920 31.51419 64.74422
## 15 47.50081 30.93950 64.06211
## 16 48.13345 31.72883 64.53807
## 
## $se.fit
##        1        2        3        4        5        6        7 
## 2.478191 2.627276 2.745055 2.616031 2.731171 2.569678 2.809507 
##        8        9       10       11       12       13       14 
## 2.784850 2.575644 2.631131 2.544125 2.720625 2.513234 2.866746 
##       15       16 
## 2.788361 2.547534 
## 
## $df
## [1] 54
## 
## $residual.scale
## [1] 7.775661</code></pre>
<p><br></p>
</div>
</div>
<div id="manually-fitting-model-using-matrix-algebra" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Manually fitting model using matrix algebra</h2>
<p>Model coefficients are the same as above - as they should be!</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="means-fitted-and-marginal.html#cb353-1" aria-hidden="true" tabindex="-1"></a>gtype.mat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(gtype.lm1)</span>
<span id="cb353-2"><a href="means-fitted-and-marginal.html#cb353-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-3"><a href="means-fitted-and-marginal.html#cb353-3" aria-hidden="true" tabindex="-1"></a>XtX.inv <span class="ot">&lt;-</span> <span class="fu">ginv</span>( <span class="fu">t</span>(gtype.mat) <span class="sc">%*%</span> gtype.mat )</span>
<span id="cb353-4"><a href="means-fitted-and-marginal.html#cb353-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-5"><a href="means-fitted-and-marginal.html#cb353-5" aria-hidden="true" tabindex="-1"></a>bhat <span class="ot">&lt;-</span> XtX.inv <span class="sc">%*%</span> <span class="fu">t</span>(gtype.mat) <span class="sc">%*%</span> gtype<span class="sc">$</span>Wt</span>
<span id="cb353-6"><a href="means-fitted-and-marginal.html#cb353-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-7"><a href="means-fitted-and-marginal.html#cb353-7" aria-hidden="true" tabindex="-1"></a>bhat</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 56.909073
## [2,] -2.025180
## [3,] -2.653575
## [4,] -2.020931
## [5,]  3.515885
## [6,] -1.832111
## [7,] -6.754690</code></pre>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="means-fitted-and-marginal.html#cb355-1" aria-hidden="true" tabindex="-1"></a>bhat.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">colnames</span>(gtype.mat), <span class="at">est =</span> bhat)</span>
<span id="cb355-2"><a href="means-fitted-and-marginal.html#cb355-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-3"><a href="means-fitted-and-marginal.html#cb355-3" aria-hidden="true" tabindex="-1"></a>bhat.df</span></code></pre></div>
<pre><code>##         param       est
## 1 (Intercept) 56.909073
## 2     LitterB -2.025180
## 3     LitterI -2.653575
## 4     LitterJ -2.020931
## 5     MotherB  3.515885
## 6     MotherI -1.832111
## 7     MotherJ -6.754690</code></pre>
<p><br></p>
</div>
<div id="estimated-means-using-model-coefficients-and-various-weights" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Estimated means using model coefficients and various weights</h2>
<p>First, get the two-way table of means.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="means-fitted-and-marginal.html#cb357-1" aria-hidden="true" tabindex="-1"></a>means.cell <span class="ot">&lt;-</span> </span>
<span id="cb357-2"><a href="means-fitted-and-marginal.html#cb357-2" aria-hidden="true" tabindex="-1"></a>  genotype <span class="sc">%&gt;%</span></span>
<span id="cb357-3"><a href="means-fitted-and-marginal.html#cb357-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Mother, Litter) <span class="sc">%&gt;%</span></span>
<span id="cb357-4"><a href="means-fitted-and-marginal.html#cb357-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">wt_mean =</span> <span class="fu">mean</span>(Wt))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Mother&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="means-fitted-and-marginal.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  Form a 4 x 4 table</span></span>
<span id="cb359-2"><a href="means-fitted-and-marginal.html#cb359-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-3"><a href="means-fitted-and-marginal.html#cb359-3" aria-hidden="true" tabindex="-1"></a>means.cell <span class="ot">&lt;-</span> <span class="fu">matrix</span>(means.cell<span class="sc">$</span>wt_mean, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb359-4"><a href="means-fitted-and-marginal.html#cb359-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-5"><a href="means-fitted-and-marginal.html#cb359-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(means.cell) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Litter_A&quot;</span>, <span class="st">&quot;Litter_B&quot;</span>, <span class="st">&quot;Litter_I&quot;</span>, <span class="st">&quot;Litter_J&quot;</span>)</span>
<span id="cb359-6"><a href="means-fitted-and-marginal.html#cb359-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(means.cell) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mother_A&quot;</span>, <span class="st">&quot;Mother_B&quot;</span>, <span class="st">&quot;Mother_I&quot;</span>, <span class="st">&quot;Mother_J&quot;</span>)</span>
<span id="cb359-7"><a href="means-fitted-and-marginal.html#cb359-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-8"><a href="means-fitted-and-marginal.html#cb359-8" aria-hidden="true" tabindex="-1"></a>means.cell</span></code></pre></div>
<pre><code>##          Mother_A Mother_B Mother_I Mother_J
## Litter_A   63.680 52.40000 54.12500 48.96000
## Litter_B   52.325 60.64000 53.92500 45.90000
## Litter_I   47.100 64.36667 51.60000 49.43333
## Litter_J   54.350 56.10000 54.53333 49.06000</code></pre>
<div id="marginal-means-for-litter" class="section level3" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> Marginal means for Litter</h3>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="means-fitted-and-marginal.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(means.cell, <span class="dv">1</span>, mean)</span></code></pre></div>
<pre><code>## Litter_A Litter_B Litter_I Litter_J 
## 54.79125 53.19750 53.12500 53.51083</code></pre>
<p>These are based on the data and are <em>not</em> the estimates returned by <em>any</em> package here with <em>any</em> weighting. Weightings used to calculate marginal means are not the ones used in the above calculation. This is because estimated marginal means are not based directly on the data but rather are derived from a model.</p>
<p><br></p>
<div id="estimates-using-emmeans-package" class="section level4" number="9.6.1.1">
<h4><span class="header-section-number">9.6.1.1</span> Estimates using “emmeans” package</h4>
<p><br></p>
</div>
<div id="reference-grid-for-emmeans" class="section level4" number="9.6.1.2">
<h4><span class="header-section-number">9.6.1.2</span> “Reference grid” for emmeans</h4>
<p>Estimated marginal means are based on a model, not directly on the raw data. They are calculated using a reference grid, which is a grid of all combinations of factors and covariates in the model.</p>
<p>The reference grid for the genotype model is shown; the grid includes cell counts (viz. the .wgt. column).</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="means-fitted-and-marginal.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ref_grid</span>(gtype.lm1) <span class="sc">@</span> grid</span></code></pre></div>
<pre><code>##    Litter Mother .wgt.
## 1       A      A     5
## 2       B      A     4
## 3       I      A     3
## 4       J      A     4
## 5       A      B     3
## 6       B      B     5
## 7       I      B     3
## 8       J      B     3
## 9       A      I     4
## 10      B      I     4
## 11      I      I     5
## 12      J      I     3
## 13      A      J     5
## 14      B      J     2
## 15      I      J     3
## 16      J      J     5</code></pre>
<p>The model can be used to estimate the mean at each point in the reference grid.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="means-fitted-and-marginal.html#cb365-1" aria-hidden="true" tabindex="-1"></a>ypred.ref.grid.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">predict</span>(<span class="fu">ref_grid</span>(gtype.lm1)), <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb365-2"><a href="means-fitted-and-marginal.html#cb365-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-3"><a href="means-fitted-and-marginal.html#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ypred.ref.grid.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Litter_A&quot;</span>, <span class="st">&quot;Litter_B&quot;</span>, </span>
<span id="cb365-4"><a href="means-fitted-and-marginal.html#cb365-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Litter_I&quot;</span>, <span class="st">&quot;Litter_J&quot;</span>)</span>
<span id="cb365-5"><a href="means-fitted-and-marginal.html#cb365-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ypred.ref.grid.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mother_A&quot;</span>, <span class="st">&quot;Mother_B&quot;</span>, </span>
<span id="cb365-6"><a href="means-fitted-and-marginal.html#cb365-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Mother_I&quot;</span>, <span class="st">&quot;Mother_J&quot;</span>)</span>
<span id="cb365-7"><a href="means-fitted-and-marginal.html#cb365-7" aria-hidden="true" tabindex="-1"></a>ypred.ref.grid.mat</span></code></pre></div>
<pre><code>##          Mother_A Mother_B Mother_I Mother_J
## Litter_A 56.90907 60.42496 55.07696 50.15438
## Litter_B 54.88389 58.39978 53.05178 48.12920
## Litter_I 54.25550 57.77138 52.42339 47.50081
## Litter_J 54.88814 58.40403 53.05603 48.13345</code></pre>
<p><br></p>
<p>Manually calculate means in reference grid from model.</p>
<p>Model equation is:</p>
<p><span class="math display">\[
\hat{y} = 
56.909 - 2.025 L_B - 2.654 L_I - 2.021 L_J + 3.516 M_B - 1.832 M_I - 6.755 M_J
\]</span></p>
<p>Mean for Litter A with Mother A = 56.91</p>
<p>Mean for Litter A with Mother I = 56.909 - 1.832 = 55.08</p>
<p>Mean for Litter I with Mother J = 56.909 - 2.654 - 6.755 = 47.50</p>
<p>This shows the means calculated from the reference grid are the model-based means.</p>
<p><br></p>
<p>Default weighting is “equal” (i.e. equally weighted average).</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="means-fitted-and-marginal.html#cb367-1" aria-hidden="true" tabindex="-1"></a>gtype.emm.L <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(gtype.lm1, <span class="at">specs =</span> <span class="st">&quot;Litter&quot;</span>)</span>
<span id="cb367-2"><a href="means-fitted-and-marginal.html#cb367-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-3"><a href="means-fitted-and-marginal.html#cb367-3" aria-hidden="true" tabindex="-1"></a>gtype.emm.L</span></code></pre></div>
<pre><code>##  Litter emmean   SE df lower.CL upper.CL
##  A        55.6 1.90 54     51.8     59.4
##  B        53.6 2.03 54     49.5     57.7
##  I        53.0 2.09 54     48.8     57.2
##  J        53.6 2.02 54     49.6     57.7
## 
## Results are averaged over the levels of: Mother 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="means-fitted-and-marginal.html#cb369-1" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.eq <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(gtype.lm1, <span class="at">specs =</span> <span class="st">&quot;Litter&quot;</span>, <span class="at">weights =</span> <span class="st">&quot;equal&quot;</span>)</span>
<span id="cb369-2"><a href="means-fitted-and-marginal.html#cb369-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-3"><a href="means-fitted-and-marginal.html#cb369-3" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.eq</span></code></pre></div>
<pre><code>##  Litter emmean   SE df lower.CL upper.CL
##  A        55.6 1.90 54     51.8     59.4
##  B        53.6 2.03 54     49.5     57.7
##  I        53.0 2.09 54     48.8     57.2
##  J        53.6 2.02 54     49.6     57.7
## 
## Results are averaged over the levels of: Mother 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="means-fitted-and-marginal.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(ypred.ref.grid.mat, <span class="dv">1</span>, mean)</span></code></pre></div>
<pre><code>## Litter_A Litter_B Litter_I Litter_J 
## 55.64134 53.61616 52.98777 53.62041</code></pre>
<p><br></p>
<p>Using weights = “proportional”</p>
<p>This option weights according to the number of observations in each level of the factor that’s being averaged over. See below.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="means-fitted-and-marginal.html#cb373-1" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.prop <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(gtype.lm1, <span class="at">specs =</span> <span class="st">&quot;Litter&quot;</span>, </span>
<span id="cb373-2"><a href="means-fitted-and-marginal.html#cb373-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">weights =</span> <span class="st">&quot;proportional&quot;</span>)</span>
<span id="cb373-3"><a href="means-fitted-and-marginal.html#cb373-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-4"><a href="means-fitted-and-marginal.html#cb373-4" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.prop</span></code></pre></div>
<pre><code>##  Litter emmean   SE df lower.CL upper.CL
##  A        55.6 1.89 54     51.8     59.4
##  B        53.5 2.03 54     49.5     57.6
##  I        52.9 2.09 54     48.7     57.1
##  J        53.6 2.02 54     49.5     57.6
## 
## Results are averaged over the levels of: Mother 
## Confidence level used: 0.95</code></pre>
<p>Get frequencies (number of observations) for each Mother. Using these gives the same result as weights = “proportional”.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="means-fitted-and-marginal.html#cb375-1" aria-hidden="true" tabindex="-1"></a>num.moth <span class="ot">&lt;-</span> <span class="fu">apply</span>(freq.cell, <span class="dv">2</span>, sum)</span>
<span id="cb375-2"><a href="means-fitted-and-marginal.html#cb375-2" aria-hidden="true" tabindex="-1"></a>num.moth</span></code></pre></div>
<pre><code>## Mother_A Mother_B Mother_I Mother_J 
##       16       14       16       15</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="means-fitted-and-marginal.html#cb377-1" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.prop2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(gtype.lm1, <span class="at">specs =</span> <span class="st">&quot;Litter&quot;</span>, </span>
<span id="cb377-2"><a href="means-fitted-and-marginal.html#cb377-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">weights =</span> num.moth)</span>
<span id="cb377-3"><a href="means-fitted-and-marginal.html#cb377-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-4"><a href="means-fitted-and-marginal.html#cb377-4" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.prop2 </span></code></pre></div>
<pre><code>##  Litter emmean   SE df lower.CL upper.CL
##  A        55.6 1.89 54     51.8     59.4
##  B        53.5 2.03 54     49.5     57.6
##  I        52.9 2.09 54     48.7     57.1
##  J        53.6 2.02 54     49.5     57.6
## 
## Results are averaged over the levels of: Mother 
## Confidence level used: 0.95</code></pre>
<p><br></p>
<p>Direct calculation behind weights = “proportional”.</p>
<p>Get the <em>reference grid</em> for the model. This is the 4 x 4 table of model-based means.</p>
<p>For Litter A, multiply each cell mean by the corresponding <em>total</em> number of observations for each Mother (i.e. num.moth are the weights). Add the result and divide by the total number of observations.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="means-fitted-and-marginal.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>( ypred.ref.grid.mat <span class="sc">%*%</span> num.moth <span class="sc">/</span> <span class="fu">sum</span>(num.moth) )</span></code></pre></div>
<pre><code>##      Litter_A Litter_B Litter_I Litter_J
## [1,] 55.57445 53.54927 52.92088 53.55352</code></pre>
<p><br></p>
</div>
<div id="using-confint" class="section level4" number="9.6.1.3">
<h4><span class="header-section-number">9.6.1.3</span> Using “confint”</h4>
<p>This gives the same output as asking for the estimated marginal means from a given model for a given predictor (i.e. same output as “gtype.emm.L” itself).</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="means-fitted-and-marginal.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(gtype.emm.L, <span class="at">side =</span> <span class="st">&quot;two-sided&quot;</span>, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##  Litter emmean   SE df lower.CL upper.CL
##  A        55.6 1.90 54     51.8     59.4
##  B        53.6 2.03 54     49.5     57.7
##  I        53.0 2.09 54     48.8     57.2
##  J        53.6 2.02 54     49.6     57.7
## 
## Results are averaged over the levels of: Mother 
## Confidence level used: 0.95</code></pre>
<p><br></p>
</div>
</div>
<div id="marginal-means-for-mother" class="section level3" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Marginal means for Mother</h3>
<p>Default weighting is “equal” (i.e. equally weighted average).</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="means-fitted-and-marginal.html#cb383-1" aria-hidden="true" tabindex="-1"></a>gtype.emm.M <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(gtype.lm1, <span class="at">specs =</span> <span class="st">&quot;Mother&quot;</span>)</span>
<span id="cb383-2"><a href="means-fitted-and-marginal.html#cb383-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-3"><a href="means-fitted-and-marginal.html#cb383-3" aria-hidden="true" tabindex="-1"></a>gtype.emm.M </span></code></pre></div>
<pre><code>##  Mother emmean   SE df lower.CL upper.CL
##  A        55.2 1.95 54     51.3     59.1
##  B        58.8 2.09 54     54.6     62.9
##  I        53.4 1.95 54     49.5     57.3
##  J        48.5 2.04 54     44.4     52.6
## 
## Results are averaged over the levels of: Litter 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="means-fitted-and-marginal.html#cb385-1" aria-hidden="true" tabindex="-1"></a>gtype.emm.M.eq <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(gtype.lm1, <span class="at">specs =</span> <span class="st">&quot;Mother&quot;</span>, <span class="at">weights =</span> <span class="st">&quot;equal&quot;</span>)</span>
<span id="cb385-2"><a href="means-fitted-and-marginal.html#cb385-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3"><a href="means-fitted-and-marginal.html#cb385-3" aria-hidden="true" tabindex="-1"></a>gtype.emm.M.eq </span></code></pre></div>
<pre><code>##  Mother emmean   SE df lower.CL upper.CL
##  A        55.2 1.95 54     51.3     59.1
##  B        58.8 2.09 54     54.6     62.9
##  I        53.4 1.95 54     49.5     57.3
##  J        48.5 2.04 54     44.4     52.6
## 
## Results are averaged over the levels of: Litter 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="means-fitted-and-marginal.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(ypred.ref.grid.mat, <span class="dv">2</span>, mean)</span></code></pre></div>
<pre><code>## Mother_A Mother_B Mother_I Mother_J 
## 55.23415 58.75004 53.40204 48.47946</code></pre>
<p><br></p>
<p>Using weights = “cells”</p>
<p>This uses cell frequencies and gives arithmetic means.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="means-fitted-and-marginal.html#cb389-1" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.cells <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(gtype.lm1, <span class="at">specs =</span> <span class="st">&quot;Litter&quot;</span>, <span class="at">weights =</span> <span class="st">&quot;cells&quot;</span>)</span>
<span id="cb389-2"><a href="means-fitted-and-marginal.html#cb389-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-3"><a href="means-fitted-and-marginal.html#cb389-3" aria-hidden="true" tabindex="-1"></a>gtype.emm.L.cells </span></code></pre></div>
<pre><code>##  Litter emmean   SE df lower.CL upper.CL
##  A        55.1 1.89 54     51.3     58.9
##  B        54.7 2.01 54     50.6     58.7
##  I        52.9 2.08 54     48.7     57.1
##  J        53.0 2.01 54     48.9     57.0
## 
## Results are averaged over the levels of: Mother 
## Confidence level used: 0.95</code></pre>
<p><br></p>
</div>
<div id="using-a-matrix-with-equal-weights" class="section level3" number="9.6.3">
<h3><span class="header-section-number">9.6.3</span> Using a matrix with equal weights</h3>
<p>Use weights for each Litter of <span class="math inline">\(\frac{1}{4}\)</span>. See notes on calculating marginal means by Cornell Stats Consult Unit<br />
(see file “marginal means calc CornellStatsConsult.pdf”).</p>
<p>This gives the same result as the default equal weighting based on the model reference grid (i.e. these are the same estimates as emmmeans gives using weights = “equal”, the default weighting).</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="means-fitted-and-marginal.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  Set up matrix with appropriate values for calculation</span></span>
<span id="cb391-2"><a href="means-fitted-and-marginal.html#cb391-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-3"><a href="means-fitted-and-marginal.html#cb391-3" aria-hidden="true" tabindex="-1"></a>mean.L.bal.wt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb391-4"><a href="means-fitted-and-marginal.html#cb391-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb391-5"><a href="means-fitted-and-marginal.html#cb391-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb391-6"><a href="means-fitted-and-marginal.html#cb391-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb391-7"><a href="means-fitted-and-marginal.html#cb391-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>),</span>
<span id="cb391-8"><a href="means-fitted-and-marginal.html#cb391-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> T)</span>
<span id="cb391-9"><a href="means-fitted-and-marginal.html#cb391-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-10"><a href="means-fitted-and-marginal.html#cb391-10" aria-hidden="true" tabindex="-1"></a>mean.L.bal.wt</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
## [1,]    1    0    0    0 0.25 0.25 0.25
## [2,]    1    1    0    0 0.25 0.25 0.25
## [3,]    1    0    1    0 0.25 0.25 0.25
## [4,]    1    0    0    1 0.25 0.25 0.25</code></pre>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="means-fitted-and-marginal.html#cb393-1" aria-hidden="true" tabindex="-1"></a>mean.L.bal.wt <span class="sc">%*%</span> bhat.df[ , <span class="dv">2</span>]</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 55.64134
## [2,] 53.61616
## [3,] 52.98777
## [4,] 53.62041</code></pre>
<p><br></p>
</div>
<div id="using-a-matrix-with-proportional-weights" class="section level3" number="9.6.4">
<h3><span class="header-section-number">9.6.4</span> Using a matrix with proportional weights</h3>
<p>There are 61 data values in all. The number of observations for each mother are shown below.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="means-fitted-and-marginal.html#cb395-1" aria-hidden="true" tabindex="-1"></a>gtype <span class="sc">%&gt;%</span></span>
<span id="cb395-2"><a href="means-fitted-and-marginal.html#cb395-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Mother)</span></code></pre></div>
<pre><code>##   Mother  n
## 1      A 16
## 2      B 14
## 3      I 16
## 4      J 15</code></pre>
<p><br></p>
<p>Calculating marginal means for litters using “proportional” weighting across Mother.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="means-fitted-and-marginal.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="do">##  Set up matrix with appropriate values for calculation</span></span>
<span id="cb397-2"><a href="means-fitted-and-marginal.html#cb397-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-3"><a href="means-fitted-and-marginal.html#cb397-3" aria-hidden="true" tabindex="-1"></a>mean.L.prop.wt <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb397-4"><a href="means-fitted-and-marginal.html#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">14</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">16</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">15</span><span class="sc">/</span><span class="dv">61</span>,</span>
<span id="cb397-5"><a href="means-fitted-and-marginal.html#cb397-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">14</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">16</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">15</span><span class="sc">/</span><span class="dv">61</span>,</span>
<span id="cb397-6"><a href="means-fitted-and-marginal.html#cb397-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">14</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">16</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">15</span><span class="sc">/</span><span class="dv">61</span>,</span>
<span id="cb397-7"><a href="means-fitted-and-marginal.html#cb397-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">14</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">16</span><span class="sc">/</span><span class="dv">61</span>, <span class="dv">15</span><span class="sc">/</span><span class="dv">61</span>),</span>
<span id="cb397-8"><a href="means-fitted-and-marginal.html#cb397-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> T)</span>
<span id="cb397-9"><a href="means-fitted-and-marginal.html#cb397-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-10"><a href="means-fitted-and-marginal.html#cb397-10" aria-hidden="true" tabindex="-1"></a>mean.L.prop.wt</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]      [,5]      [,6]      [,7]
## [1,]    1    0    0    0 0.2295082 0.2622951 0.2459016
## [2,]    1    1    0    0 0.2295082 0.2622951 0.2459016
## [3,]    1    0    1    0 0.2295082 0.2622951 0.2459016
## [4,]    1    0    0    1 0.2295082 0.2622951 0.2459016</code></pre>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="means-fitted-and-marginal.html#cb399-1" aria-hidden="true" tabindex="-1"></a>mean.L.prop.wt <span class="sc">%*%</span> bhat.df[ , <span class="dv">2</span>]</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 55.57445
## [2,] 53.54927
## [3,] 52.92088
## [4,] 53.55352</code></pre>
<p>These are the same estimates as emmmeans gives using weights = “proportional”.</p>
<p><br></p>
</div>
</div>
<div id="estimates-using-effects-package" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Estimates using “effects” package</h2>
<p>The “effects” package, by default, uses what is “proportional” weighting in the emmeans package.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="means-fitted-and-marginal.html#cb401-1" aria-hidden="true" tabindex="-1"></a>gtype.eff.L <span class="ot">&lt;-</span> <span class="fu">effect</span>(<span class="st">&quot;Litter&quot;</span>, <span class="at">mod =</span> gtype.lm1)</span>
<span id="cb401-2"><a href="means-fitted-and-marginal.html#cb401-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-3"><a href="means-fitted-and-marginal.html#cb401-3" aria-hidden="true" tabindex="-1"></a>gtype.eff.L.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gtype.eff.L)</span>
<span id="cb401-4"><a href="means-fitted-and-marginal.html#cb401-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-5"><a href="means-fitted-and-marginal.html#cb401-5" aria-hidden="true" tabindex="-1"></a>gtype.eff.L.df</span></code></pre></div>
<pre><code>##   Litter      fit       se    lower    upper
## 1      A 55.57445 1.893599 51.77802 59.37089
## 2      B 53.54927 2.032817 49.47372 57.62483
## 3      I 52.92088 2.089806 48.73107 57.11069
## 4      J 53.55352 2.020382 49.50290 57.60414</code></pre>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="means-fitted-and-marginal.html#cb403-1" aria-hidden="true" tabindex="-1"></a>gtype.eff.all <span class="ot">&lt;-</span> <span class="fu">allEffects</span>(gtype.lm1)</span>
<span id="cb403-2"><a href="means-fitted-and-marginal.html#cb403-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-3"><a href="means-fitted-and-marginal.html#cb403-3" aria-hidden="true" tabindex="-1"></a>gtype.eff.all</span></code></pre></div>
<pre><code>##  model: Wt ~ Litter + Mother
## 
##  Litter effect
## Litter
##        A        B        I        J 
## 55.57445 53.54927 52.92088 53.55352 
## 
##  Mother effect
## Mother
##        A        B        I        J 
## 55.30511 58.82100 53.47300 48.55042</code></pre>
<p><br></p>
</div>
<div id="transformations-and-emmeans" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> Transformations and <code>emmeans</code></h2>
<p>Data is “rice” from DAAG package.</p>
<p>The rice data frame has 72 rows and 7 columns. The data are from an experiment that compared wild type (wt) and genetically modified rice plants (ANU843), each with three different chemical treatments (F10, NH4Cl, and NH4NO3).</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="means-fitted-and-marginal.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rice, <span class="at">package =</span> <span class="st">&quot;DAAG&quot;</span>)</span>
<span id="cb405-2"><a href="means-fitted-and-marginal.html#cb405-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-3"><a href="means-fitted-and-marginal.html#cb405-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rice)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    72 obs. of  7 variables:
##  $ PlantNo     : num  1 2 3 4 5 6 7 8 9 10 ...
##  $ Block       : num  1 1 1 1 1 1 2 2 2 2 ...
##  $ RootDryMass : num  56 66 40 43 55 66 41 67 40 35 ...
##  $ ShootDryMass: num  132 120 108 134 119 125 98 122 114 82 ...
##  $ trt         : Factor w/ 6 levels &quot;F10&quot;,&quot;NH4Cl&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ fert        : Factor w/ 3 levels &quot;F10&quot;,&quot;NH4Cl&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ variety     : Factor w/ 2 levels &quot;wt&quot;,&quot;ANU843&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="means-fitted-and-marginal.html#cb407-1" aria-hidden="true" tabindex="-1"></a>rice<span class="sc">$</span>PlantNo <span class="ot">&lt;-</span> <span class="fu">factor</span>(rice<span class="sc">$</span>PlantNo)</span>
<span id="cb407-2"><a href="means-fitted-and-marginal.html#cb407-2" aria-hidden="true" tabindex="-1"></a>rice<span class="sc">$</span>Block <span class="ot">&lt;-</span> <span class="fu">factor</span>(rice<span class="sc">$</span>Block)</span></code></pre></div>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="means-fitted-and-marginal.html#cb408-1" aria-hidden="true" tabindex="-1"></a>rice <span class="sc">%&gt;%</span></span>
<span id="cb408-2"><a href="means-fitted-and-marginal.html#cb408-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Block, PlantNo) <span class="sc">%&gt;%</span></span>
<span id="cb408-3"><a href="means-fitted-and-marginal.html#cb408-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   Block, PlantNo [12]
##    Block PlantNo     n
##    &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;
##  1 1     1           6
##  2 1     2           6
##  3 1     3           6
##  4 1     4           6
##  5 1     5           6
##  6 1     6           6
##  7 2     7           6
##  8 2     8           6
##  9 2     9           6
## 10 2     10          6
## 11 2     11          6
## 12 2     12          6</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="means-fitted-and-marginal.html#cb410-1" aria-hidden="true" tabindex="-1"></a>rice <span class="sc">%&gt;%</span></span>
<span id="cb410-2"><a href="means-fitted-and-marginal.html#cb410-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fert, variety) <span class="sc">%&gt;%</span></span>
<span id="cb410-3"><a href="means-fitted-and-marginal.html#cb410-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   fert, variety [6]
##   fert   variety     n
##   &lt;fct&gt;  &lt;fct&gt;   &lt;int&gt;
## 1 F10    wt         12
## 2 F10    ANU843     12
## 3 NH4Cl  wt         12
## 4 NH4Cl  ANU843     12
## 5 NH4NO3 wt         12
## 6 NH4NO3 ANU843     12</code></pre>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="means-fitted-and-marginal.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rice, <span class="fu">aes</span>(<span class="at">x =</span> Block, <span class="at">y =</span> ShootDryMass)) <span class="sc">+</span></span>
<span id="cb412-2"><a href="means-fitted-and-marginal.html#cb412-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-215-1.png" width="672" /></p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="means-fitted-and-marginal.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rice, <span class="fu">aes</span>(<span class="at">x =</span> PlantNo, <span class="at">y =</span> ShootDryMass)) <span class="sc">+</span></span>
<span id="cb413-2"><a href="means-fitted-and-marginal.html#cb413-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-216-1.png" width="672" /></p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="means-fitted-and-marginal.html#cb414-1" aria-hidden="true" tabindex="-1"></a>bw1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rice, <span class="fu">aes</span>(<span class="at">x =</span> fert, <span class="at">y =</span> ShootDryMass)) <span class="sc">+</span> </span>
<span id="cb414-2"><a href="means-fitted-and-marginal.html#cb414-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb414-3"><a href="means-fitted-and-marginal.html#cb414-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-4"><a href="means-fitted-and-marginal.html#cb414-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-5"><a href="means-fitted-and-marginal.html#cb414-5" aria-hidden="true" tabindex="-1"></a>bw2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rice, <span class="fu">aes</span>(<span class="at">x =</span> variety, <span class="at">y =</span> ShootDryMass)) <span class="sc">+</span> </span>
<span id="cb414-6"><a href="means-fitted-and-marginal.html#cb414-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb414-7"><a href="means-fitted-and-marginal.html#cb414-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-8"><a href="means-fitted-and-marginal.html#cb414-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(bw1, bw2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-217-1.png" width="672" /></p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="means-fitted-and-marginal.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rice, <span class="fu">aes</span>(<span class="at">x =</span> fert, <span class="at">y =</span> ShootDryMass, <span class="at">fill =</span> variety)) <span class="sc">+</span></span>
<span id="cb415-2"><a href="means-fitted-and-marginal.html#cb415-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-218-1.png" width="672" /></p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="means-fitted-and-marginal.html#cb416-1" aria-hidden="true" tabindex="-1"></a>rice.lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ShootDryMass <span class="sc">~</span> Block <span class="sc">+</span> fert <span class="sc">*</span> variety, <span class="at">data =</span> rice)</span>
<span id="cb416-2"><a href="means-fitted-and-marginal.html#cb416-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-3"><a href="means-fitted-and-marginal.html#cb416-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rice.lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ShootDryMass ~ Block + fert * variety, data = rice)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -64.333  -9.813  -0.292  11.688  48.667 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)               115.333      5.609  20.562  &lt; 2e-16 ***
## Block2                    -14.000      4.240  -3.302  0.00156 ** 
## fertNH4Cl                 -58.083      7.344  -7.909 4.24e-11 ***
## fertNH4NO3                -35.000      7.344  -4.766 1.10e-05 ***
## varietyANU843            -101.000      7.344 -13.753  &lt; 2e-16 ***
## fertNH4Cl:varietyANU843    97.333     10.386   9.372 1.10e-13 ***
## fertNH4NO3:varietyANU843   99.167     10.386   9.548 5.42e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 17.99 on 65 degrees of freedom
## Multiple R-squared:  0.7736, Adjusted R-squared:  0.7527 
## F-statistic: 37.01 on 6 and 65 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="means-fitted-and-marginal.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(rice.lm1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: ShootDryMass
##              Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Block         1   3528  3528.0  10.902  0.001563 ** 
## fert          2   7019  3509.4  10.845 8.625e-05 ***
## variety       1  22685 22684.5  70.100 6.366e-12 ***
## fert:variety  2  38622 19311.2  59.676 1.933e-15 ***
## Residuals    65  21034   323.6                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="means-fitted-and-marginal.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb420-2"><a href="means-fitted-and-marginal.html#cb420-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rice.lm1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-221-1.png" width="672" /></p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="means-fitted-and-marginal.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><br></p>
<p>Log-transform the response to illustrate the point of this exercise!</p>
<p><strong>The analysis above clearly isn’t satisfactory but the use of <code>emmeans</code> here is the point.</strong></p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="means-fitted-and-marginal.html#cb422-1" aria-hidden="true" tabindex="-1"></a>rice<span class="sc">$</span>logShootDM <span class="ot">&lt;-</span> <span class="fu">log</span>(rice<span class="sc">$</span>ShootDryMass)</span>
<span id="cb422-2"><a href="means-fitted-and-marginal.html#cb422-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-3"><a href="means-fitted-and-marginal.html#cb422-3" aria-hidden="true" tabindex="-1"></a>bw3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rice, <span class="fu">aes</span>(<span class="at">x =</span> fert, <span class="at">y =</span> logShootDM)) <span class="sc">+</span> </span>
<span id="cb422-4"><a href="means-fitted-and-marginal.html#cb422-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb422-5"><a href="means-fitted-and-marginal.html#cb422-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-6"><a href="means-fitted-and-marginal.html#cb422-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-7"><a href="means-fitted-and-marginal.html#cb422-7" aria-hidden="true" tabindex="-1"></a>bw4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rice, <span class="fu">aes</span>(<span class="at">x =</span> variety, <span class="at">y =</span> logShootDM)) <span class="sc">+</span> </span>
<span id="cb422-8"><a href="means-fitted-and-marginal.html#cb422-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb422-9"><a href="means-fitted-and-marginal.html#cb422-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-10"><a href="means-fitted-and-marginal.html#cb422-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(bw3, bw4, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-222-1.png" width="672" /></p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="means-fitted-and-marginal.html#cb423-1" aria-hidden="true" tabindex="-1"></a>rice.lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logShootDM <span class="sc">~</span> Block <span class="sc">+</span> fert <span class="sc">*</span> variety, <span class="at">data =</span> rice)</span>
<span id="cb423-2"><a href="means-fitted-and-marginal.html#cb423-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-3"><a href="means-fitted-and-marginal.html#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rice.lm2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logShootDM ~ Block + fert * variety, data = rice)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.79849 -0.19150  0.06138  0.20177  1.10562 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                4.6764     0.1376  33.991  &lt; 2e-16 ***
## Block2                    -0.0709     0.1040  -0.682    0.498    
## fertNH4Cl                 -0.7823     0.1801  -4.343 5.03e-05 ***
## fertNH4NO3                -0.3878     0.1801  -2.153    0.035 *  
## varietyANU843             -2.8779     0.1801 -15.977  &lt; 2e-16 ***
## fertNH4Cl:varietyANU843    2.8093     0.2547  11.028  &lt; 2e-16 ***
## fertNH4NO3:varietyANU843   2.8522     0.2547  11.196  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4412 on 65 degrees of freedom
## Multiple R-squared:  0.8326, Adjusted R-squared:  0.8171 
## F-statistic: 53.87 on 6 and 65 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Get the estimated marginal means of fertiliser for each variety.</p>
<p><em>Note these estimates are on the log scale.</em></p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="means-fitted-and-marginal.html#cb425-1" aria-hidden="true" tabindex="-1"></a>rice_emm_f_v <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(rice.lm2, pairwise <span class="sc">~</span> fert <span class="sc">|</span> variety)</span>
<span id="cb425-2"><a href="means-fitted-and-marginal.html#cb425-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-3"><a href="means-fitted-and-marginal.html#cb425-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rice_emm_f_v)</span></code></pre></div>
<pre><code>## $emmeans
## variety = wt:
##  fert   emmean    SE df lower.CL upper.CL
##  F10      4.64 0.127 65     4.39     4.90
##  NH4Cl    3.86 0.127 65     3.60     4.11
##  NH4NO3   4.25 0.127 65     4.00     4.51
## 
## variety = ANU843:
##  fert   emmean    SE df lower.CL upper.CL
##  F10      1.76 0.127 65     1.51     2.02
##  NH4Cl    3.79 0.127 65     3.54     4.04
##  NH4NO3   4.23 0.127 65     3.97     4.48
## 
## Results are averaged over the levels of: Block 
## Confidence level used: 0.95 
## 
## $contrasts
## variety = wt:
##  contrast       estimate   SE df t.ratio p.value
##  F10 - NH4Cl       0.782 0.18 65   4.343 0.0001 
##  F10 - NH4NO3      0.388 0.18 65   2.153 0.0872 
##  NH4Cl - NH4NO3   -0.394 0.18 65  -2.190 0.0805 
## 
## variety = ANU843:
##  contrast       estimate   SE df t.ratio p.value
##  F10 - NH4Cl      -2.027 0.18 65 -11.253 &lt;.0001 
##  F10 - NH4NO3     -2.464 0.18 65 -13.681 &lt;.0001 
##  NH4Cl - NH4NO3   -0.437 0.18 65  -2.428 0.0466 
## 
## Results are averaged over the levels of: Block 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
<p>Backtransform the estimates to the natural scale. Note this code comes from the built-in help for <code>emmeans</code>.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="means-fitted-and-marginal.html#cb427-1" aria-hidden="true" tabindex="-1"></a>rice_emm_f_v_bt <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(rice.lm2, pairwise <span class="sc">~</span> fert <span class="sc">|</span> variety,</span>
<span id="cb427-2"><a href="means-fitted-and-marginal.html#cb427-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">tran =</span> <span class="st">&quot;log&quot;</span>), </span>
<span id="cb427-3"><a href="means-fitted-and-marginal.html#cb427-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb427-4"><a href="means-fitted-and-marginal.html#cb427-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-5"><a href="means-fitted-and-marginal.html#cb427-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rice_emm_f_v_bt)</span></code></pre></div>
<pre><code>## $emmeans
## variety = wt:
##  fert   response     SE df lower.CL upper.CL
##  F10      103.65 13.202 65    80.37   133.67
##  NH4Cl     47.40  6.038 65    36.76    61.13
##  NH4NO3    70.33  8.958 65    54.53    90.70
## 
## variety = ANU843:
##  fert   response     SE df lower.CL upper.CL
##  F10        5.83  0.743 65     4.52     7.52
##  NH4Cl     44.26  5.637 65    34.32    57.08
##  NH4NO3    68.54  8.730 65    53.14    88.39
## 
## Results are averaged over the levels of: Block 
## Confidence level used: 0.95 
## Intervals are back-transformed from the log scale 
## 
## $contrasts
## variety = wt:
##  contrast        ratio     SE df t.ratio p.value
##  F10 / NH4Cl    2.1866 0.3939 65   4.343 0.0001 
##  F10 / NH4NO3   1.4738 0.2655 65   2.153 0.0872 
##  NH4Cl / NH4NO3 0.6740 0.1214 65  -2.190 0.0805 
## 
## variety = ANU843:
##  contrast        ratio     SE df t.ratio p.value
##  F10 / NH4Cl    0.1317 0.0237 65 -11.253 &lt;.0001 
##  F10 / NH4NO3   0.0851 0.0153 65 -13.681 &lt;.0001 
##  NH4Cl / NH4NO3 0.6457 0.1163 65  -2.428 0.0466 
## 
## Results are averaged over the levels of: Block 
## P value adjustment: tukey method for comparing a family of 3 estimates 
## Tests are performed on the log scale</code></pre>
<p>Further, to get confidence intervals for the contrasts, do the following. <em>Note that you use the <code>emmeans</code> object, not the summary of that object!</em></p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="means-fitted-and-marginal.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(rice_emm_f_v_bt<span class="sc">$</span>contrasts)</span></code></pre></div>
<pre><code>## variety = wt:
##  contrast        ratio     SE df lower.CL upper.CL
##  F10 / NH4Cl    2.1866 0.3939 65   1.4195    3.368
##  F10 / NH4NO3   1.4738 0.2655 65   0.9567    2.270
##  NH4Cl / NH4NO3 0.6740 0.1214 65   0.4376    1.038
## 
## variety = ANU843:
##  contrast        ratio     SE df lower.CL upper.CL
##  F10 / NH4Cl    0.1317 0.0237 65   0.0855    0.203
##  F10 / NH4NO3   0.0851 0.0153 65   0.0552    0.131
##  NH4Cl / NH4NO3 0.6457 0.1163 65   0.4192    0.995
## 
## Results are averaged over the levels of: Block 
## Confidence level used: 0.95 
## Conf-level adjustment: tukey method for comparing a family of 3 estimates 
## Intervals are back-transformed from the log scale</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="count-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": null
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
